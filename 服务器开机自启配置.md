# æœåŠ¡å™¨å¼€æœºè‡ªå¯é…ç½®è¯´æ˜

## âœ… å·²é…ç½®çš„æœåŠ¡

### 1. PM2ï¼ˆåç«¯Node.jsæœåŠ¡ï¼‰
- **çŠ¶æ€**ï¼šâœ… å·²å¯ç”¨
- **æœåŠ¡å**ï¼š`pm2-ubuntu.service`
- **ç®¡ç†çš„è¿›ç¨‹**ï¼š`xinfu-backend`ï¼ˆå¹¸ç¦åŠ›åç«¯æœåŠ¡ï¼Œç«¯å£3001ï¼‰
- **é…ç½®æ–‡ä»¶**ï¼š`/etc/systemd/system/pm2-ubuntu.service`

**ç®¡ç†å‘½ä»¤ï¼š**
```bash
# æŸ¥çœ‹PM2æœåŠ¡çŠ¶æ€
sudo systemctl status pm2-ubuntu

# å¯åŠ¨/åœæ­¢/é‡å¯PM2æœåŠ¡
sudo systemctl start pm2-ubuntu
sudo systemctl stop pm2-ubuntu
sudo systemctl restart pm2-ubuntu

# PM2è¿›ç¨‹ç®¡ç†
pm2 list              # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 restart xinfu-backend  # é‡å¯åç«¯æœåŠ¡
pm2 logs xinfu-backend     # æŸ¥çœ‹æ—¥å¿—
pm2 save              # ä¿å­˜è¿›ç¨‹åˆ—è¡¨ï¼ˆæ·»åŠ æ–°æœåŠ¡åå¿…é¡»æ‰§è¡Œï¼‰
```

---

### 2. Nginxï¼ˆå‰ç«¯WebæœåŠ¡å™¨ï¼‰
- **çŠ¶æ€**ï¼šâœ… å·²å¯ç”¨
- **æœåŠ¡å**ï¼š`nginx.service`
- **åŠŸèƒ½**ï¼š
  - åå‘ä»£ç†åç«¯APIï¼ˆ`/api` â†’ `http://localhost:3001`ï¼‰
  - é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆH5å‰ç«¯ï¼š`/h5`ï¼ŒAdminåå°ï¼š`/admin`ï¼‰

**ç®¡ç†å‘½ä»¤ï¼š**
```bash
# æŸ¥çœ‹NginxçŠ¶æ€
sudo systemctl status nginx

# å¯åŠ¨/åœæ­¢/é‡å¯Nginx
sudo systemctl start nginx
sudo systemctl stop nginx
sudo systemctl restart nginx

# é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
sudo nginx -t          # æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®
sudo nginx -s reload   # é‡æ–°åŠ è½½é…ç½®
```

**é…ç½®æ–‡ä»¶**ï¼š`/etc/nginx/sites-available/xinfu.conf`

---

### 3. MySQLï¼ˆæ•°æ®åº“æœåŠ¡ï¼‰
- **çŠ¶æ€**ï¼šâœ… å·²å¯ç”¨
- **æœåŠ¡å**ï¼š`mysql.service`
- **æ•°æ®åº“å**ï¼š`xinfu_db`
- **ç”¨æˆ·**ï¼š`root`
- **å¯†ç **ï¼š`Xinfuli2024!`

**ç®¡ç†å‘½ä»¤ï¼š**
```bash
# æŸ¥çœ‹MySQLçŠ¶æ€
sudo systemctl status mysql

# å¯åŠ¨/åœæ­¢/é‡å¯MySQL
sudo systemctl start mysql
sudo systemctl stop mysql
sudo systemctl restart mysql

# è¿æ¥æ•°æ®åº“
mysql -uroot -p'Xinfuli2024!' xinfu_db
```

---

## ğŸ”„ å¼€æœºå¯åŠ¨æµç¨‹

æœåŠ¡å™¨é‡å¯åï¼ŒæœåŠ¡å¯åŠ¨é¡ºåºï¼š

1. **MySQL** å¯åŠ¨ï¼ˆæ•°æ®åº“æœåŠ¡ï¼‰
2. **Nginx** å¯åŠ¨ï¼ˆWebæœåŠ¡å™¨ï¼‰
3. **PM2** å¯åŠ¨ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
4. **xinfu-backend** è‡ªåŠ¨å¯åŠ¨ï¼ˆåç«¯æœåŠ¡ï¼‰

---

## ğŸ§ª æµ‹è¯•å¼€æœºè‡ªå¯

### æ–¹æ³•1ï¼šæŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh -i ~/.ssh/XFL.pem ubuntu@124.222.88.25

# æ£€æŸ¥æ‰€æœ‰æœåŠ¡æ˜¯å¦å¯ç”¨
sudo systemctl is-enabled pm2-ubuntu
sudo systemctl is-enabled nginx
sudo systemctl is-enabled mysql

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
pm2 list
sudo systemctl status nginx
sudo systemctl status mysql
```

### æ–¹æ³•2ï¼šæ¨¡æ‹Ÿé‡å¯ï¼ˆå¯é€‰ï¼Œè°¨æ…æ“ä½œï¼‰
```bash
# é‡å¯æœåŠ¡å™¨ï¼ˆä¼šä¸­æ–­æœåŠ¡1-2åˆ†é’Ÿï¼‰
ssh -i ~/.ssh/XFL.pem ubuntu@124.222.88.25 "sudo reboot"

# ç­‰å¾…2åˆ†é’Ÿåï¼Œæ£€æŸ¥æœåŠ¡æ˜¯å¦è‡ªåŠ¨å¯åŠ¨
ssh -i ~/.ssh/XFL.pem ubuntu@124.222.88.25 "pm2 list && sudo systemctl status nginx mysql"

# è®¿é—®å‰ç«¯éªŒè¯
# http://124.222.88.25:8080/admin/
# http://124.222.88.25:8080/h5/
```

---

## ğŸ“‹ è®¿é—®åœ°å€

- **Adminåå°**ï¼šhttp://124.222.88.25:8080/admin/
- **H5å‰å°**ï¼šhttp://124.222.88.25:8080/h5/
- **APIæ¥å£**ï¼šhttp://124.222.88.25:8080/api/v1/

---

## âš ï¸ æ•…éšœæ’æŸ¥

### å¦‚æœé‡å¯åæœåŠ¡æœªå¯åŠ¨ï¼š

1. **æ£€æŸ¥PM2æœåŠ¡**
```bash
sudo systemctl status pm2-ubuntu
sudo journalctl -u pm2-ubuntu -n 50  # æŸ¥çœ‹æ—¥å¿—
```

2. **æ£€æŸ¥åç«¯è¿›ç¨‹**
```bash
pm2 list
pm2 logs xinfu-backend --lines 50
```

3. **æ£€æŸ¥ç«¯å£å ç”¨**
```bash
sudo netstat -tlnp | grep -E ':(3001|8080|3306)'
```

4. **æ‰‹åŠ¨å¯åŠ¨æœåŠ¡**
```bash
# å¦‚æœPM2æœåŠ¡æœªå¯åŠ¨
sudo systemctl start pm2-ubuntu

# å¦‚æœåç«¯è¿›ç¨‹æœªè¿è¡Œ
cd /www/projects/xinfu-project/backend
pm2 start ecosystem.config.js
pm2 save
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **å®šæœŸå¤‡ä»½æ•°æ®åº“**
```bash
# å¤‡ä»½è„šæœ¬ï¼ˆå¯ä»¥æ·»åŠ åˆ°crontabå®šæ—¶æ‰§è¡Œï¼‰
mysqldump -uroot -p'Xinfuli2024!' xinfu_db > /backup/xinfu_db_$(date +%Y%m%d).sql
```

2. **ç›‘æ§æœåŠ¡çŠ¶æ€**
```bash
# æ·»åŠ ç›‘æ§è„šæœ¬ï¼Œæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
crontab -e
# æ·»åŠ ï¼š*/5 * * * * /path/to/check_services.sh
```

3. **ä¿æŒç³»ç»Ÿæ›´æ–°**
```bash
sudo apt update && sudo apt upgrade -y
```

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. PM2æ—¥å¿—ï¼š`pm2 logs xinfu-backend`
2. Nginxæ—¥å¿—ï¼š`/var/log/nginx/error.log`
3. MySQLæ—¥å¿—ï¼š`/var/log/mysql/error.log`
