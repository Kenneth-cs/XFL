以下是**九型人格测试（计算+展示）最终版规则说明（代码可直接映射实现）**


### 一、预设常量参数（代码中存为全局常量）
需提前定义3组固定映射关系：
1. **人格-标准得分(A)映射**（每个人格的固定满分）：
   ```json
   {
     "1号": 31, "2号": 33, "3号": 30, "4号": 33,
     "5号": 35, "6号": 30, "7号": 32, "8号": 30, "9号": 34
   }
   ```
2. **人格-名称映射**（每个人格的官方称谓）：
   ```json
   {
     "1号": "完美型", "2号": "助人型", "3号": "成就型", "4号": "艺术型",
     "5号": "智慧型", "6号": "忠诚型", "7号": "活跃型", "8号": "领袖型", "9号": "和平型"
   }
   ```
3. **题库关联规则**（对应之前的题库）：
   每个题目选项对应唯一人格（如题目1选项A对应5号、选项B对应2号），用户选择某选项后，该选项对应的人格实际得分+1。


### 二、输入数据（代码接收的用户作答数据）
接收用户对题库所有题目的选择结果（数组格式）：
- 每一项为`{ "questionId": 题目序号, "selectedOption": "A"/"B" }`
- 示例：`[{ "questionId": 1, "selectedOption": "A" }, { "questionId": 2, "selectedOption": "B" }, ...]`


### 三、结果计算流程（代码执行步骤）
#### 步骤1：累计实际得分(B)
遍历用户选择列表，按“题库关联规则”给对应人格累加得分：
```python
# 伪代码示例
实际得分映射 = { "1号":0, "2号":0, ..., "9号":0 }  # 初始化全0
for 作答项 in 用户选择列表:
    题目信息 = 题库[作答项["questionId"]]  # 从题库取当前题目的选项-人格映射
    选中的人格 = 题目信息[作答项["selectedOption"]]["type"]  # 如选A则取optionA.type
    实际得分映射[选中的人格] += 1
```


#### 步骤2：计算百分比
遍历1-9号人格，计算“实际得分(B)/标准得分(A)”的百分比（保留整数）：
```python
# 伪代码示例
百分比映射 = {}
for 人格编号 in "1号"到"9号":
    标准得分A = 人格-标准得分映射[人格编号]
    实际得分B = 实际得分映射[人格编号]
    百分比 = int( (实际得分B / 标准得分A) * 100 )  # 四舍五入或取整
    百分比映射[人格编号] = 百分比
```


#### 步骤3：筛选有效人格
1. 取`百分比映射`中的**最大值（max_percent）**；
2. 计算有效阈值：`valid_threshold = max_percent - 15`；
3. 筛选出**百分比 ≥ valid_threshold**的人格，得到`有效人格列表`；
4. 若`有效人格列表`内有人格百分比相同，按**人格编号1→9升序**排序。
5.兜底策略：至少保留前三位人格


#### 步骤4：确定候选人格
从`有效人格列表`中，选取**百分比最高的3个**（若有并列，按人格编号1→9升序选），得到`前三候选人格列表`。


### 四、展示样式规则（代码渲染要求）
#### 1. 九型人格占比柱状图
- **图表标题**：固定为《专业九型性格测试结果》；
- **X轴排序规则**：
  1. 先按`百分比映射`的**百分比降序**排序；
  2. 百分比相同的人格，按**人格编号1→9升序**排序；
- **X轴项内容**：每个轴项显示“[人格编号]（[人格名称]）”（如“9号（和平型）”）；
- **Y轴**：百分比数值（范围0%~100%）；
- **柱子样式**：每个柱子高度匹配对应人格的百分比，柱子顶部显示具体百分比数值（如67.7%）。


#### 2. 柱状图下方说明文本
按固定格式填充动态内容：
1. 第一行：文案显示`测试结果，选取三个最高值`
2. 第二行：文案显示`数值越高，说明你这个号码的特征相对越多。数值越低，说明你这个号码的特征相对较少。`；
3. 第三行：文案显示`这三个高分值的性格型号介绍，都看看，试试看你更像哪个，最像的那个可能就是你的性格类型`；


### 五、示例演示（代码执行效果参考）
以“图1中A男数据”为例：
1. 实际得分映射：`{ "1号":25, "2号":29, "3号":21, ..., "9号":9 }`；
2. 百分比映射：`{ "1号":81, "2号":88, "3号":70, ..., "9号":26 }`；
3. 有效阈值：`88-15=73`，有效人格列表：`["2号（88%）", "1号（81%）", "3号（70%）"]`；
4. 前三候选：`2号、1号、3号`；
5. 图表X轴排序：按百分比降序为`2号、1号、3号、4号、...、9号`；


