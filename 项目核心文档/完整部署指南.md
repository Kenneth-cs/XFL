# å¹¸ç¦åŠ›é¡¹ç›® - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
- [ä¸€ã€æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚](#ä¸€æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚)
- [äºŒã€éƒ¨ç½²å‰å‡†å¤‡](#äºŒéƒ¨ç½²å‰å‡†å¤‡)
- [ä¸‰ã€æœ¬åœ°æ“ä½œæ­¥éª¤](#ä¸‰æœ¬åœ°æ“ä½œæ­¥éª¤)
- [å››ã€æœåŠ¡å™¨æ“ä½œæ­¥éª¤](#å››æœåŠ¡å™¨æ“ä½œæ­¥éª¤)
- [äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#äº”å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
- [å…­ã€éªŒè¯ä¸æµ‹è¯•](#å…­éªŒè¯ä¸æµ‹è¯•)

---

## ä¸€ã€æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 1æ ¸å¿ƒ
- **å†…å­˜**: 2GBï¼ˆå»ºè®®4GBï¼‰
- **ç£ç›˜**: 50GB
- **æ“ä½œç³»ç»Ÿ**: CentOS 7+ã€Ubuntu 18.04+ã€TencentOS Server 4

### å¿…éœ€è½¯ä»¶
- **Node.js**: v18.0+ï¼ˆå»ºè®® v20.xï¼‰
- **MySQL**: 8.0+
- **Redis**: 7.0+
- **Nginx**: 1.18+
- **PM2**: æœ€æ–°ç‰ˆ

### ç«¯å£è§„åˆ’
| æœåŠ¡ | é»˜è®¤ç«¯å£ | å¤‡æ³¨ |
|------|---------|------|
| åç«¯API | 3001 | å¯è‡ªå®šä¹‰ï¼Œéœ€ä¸å‰ç«¯é…ç½®ä¸€è‡´ |
| Nginx | 8080 | å¤–éƒ¨è®¿é—®å…¥å£ï¼ˆå¦‚éœ€80ç«¯å£éœ€ä¿®æ”¹é…ç½®ï¼‰ |
| MySQL | 3306 | å†…éƒ¨è®¿é—® |
| Redis | 6379 | å†…éƒ¨è®¿é—® |

---

## äºŒã€éƒ¨ç½²å‰å‡†å¤‡

### 2.1 æœåŠ¡å™¨ç¯å¢ƒæ£€æŸ¥

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ£€æŸ¥ç°æœ‰ç¯å¢ƒï¼š

```bash
# æŸ¥çœ‹ç›‘å¬çš„ç«¯å£
ss -tuln | grep LISTEN | awk '{print $5}' | sed 's/.*://' | sort -n | uniq

# æŸ¥çœ‹Node.jsç‰ˆæœ¬
node -v
npm -v

# æŸ¥çœ‹MySQLç‰ˆæœ¬
mysql --version

# æŸ¥çœ‹RedisçŠ¶æ€
systemctl status redis

# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx

# æŸ¥çœ‹ç£ç›˜å’Œå†…å­˜
df -h
free -h
```

**å…³é”®æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤ `3001` å’Œ `8080` ç«¯å£æœªè¢«å ç”¨
2. MySQL å·²å®‰è£…å¹¶è¿è¡Œ
3. å†…å­˜è‡³å°‘æœ‰ 500MB å¯ç”¨ï¼ˆå¦åˆ™éœ€åˆ›å»ºSwapï¼‰

### 2.2 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
mkdir -p /www/projects/xinfu-project/{logs,database}
```

---

## ä¸‰ã€æœ¬åœ°æ“ä½œæ­¥éª¤

### 3.1 ä¿®æ”¹å‰ç«¯é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

åœ¨éƒ¨ç½²å‰ï¼Œå¿…é¡»å…ˆä¿®æ”¹å‰ç«¯çš„ `vite.config.ts` æ–‡ä»¶ï¼š

**ç®¡ç†åå°** (`frontend-admin/vite.config.ts`):
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { fileURLToPath, URL } from 'node:url'

export default defineConfig({
  base: '/admin/',  // âš ï¸ å…³é”®ï¼šè®¾ç½®åŸºç¡€è·¯å¾„
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  server: {
    port: 5175,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      }
    }
  }
})
```

**H5å‰å°** (`frontend-h5/vite.config.ts`):
```typescript
import { fileURLToPath, URL } from 'node:url'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import Components from 'unplugin-vue-components/vite'
import { VantResolver } from 'unplugin-vue-components/resolvers'

export default defineConfig({
  base: '/h5/',  // âš ï¸ å…³é”®ï¼šè®¾ç½®åŸºç¡€è·¯å¾„
  plugins: [
    vue(),
    Components({
      resolvers: [VantResolver()],
    }),
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  server: {
    port: 5174,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      }
    }
  }
})
```

### 3.2 æ‰“åŒ…é¡¹ç›®

åœ¨æœ¬åœ°æ‰§è¡Œï¼š

```bash
cd "/path/to/å¹¸ç¦åŠ›é¡¹ç›®å¼€å‘"

# æ‰“åŒ…é¡¹ç›®ï¼ˆæ’é™¤ node_modulesã€.gitã€distã€logsï¼‰
tar --exclude='node_modules' \
    --exclude='.git' \
    --exclude='*.log' \
    --exclude='dist' \
    --exclude='deployment' \
    --exclude='dump.rdb' \
    -czf xinfu-project-full.tar.gz \
    backend frontend-admin frontend-h5 database

echo "âœ… æ‰“åŒ…å®Œæˆ: xinfu-project-full.tar.gz"
ls -lh xinfu-project-full.tar.gz
```

### 3.3 ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
scp xinfu-project-full.tar.gz root@<æœåŠ¡å™¨IP>:/tmp/

# æ¸…ç†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶
rm xinfu-project-full.tar.gz
```

---

## å››ã€æœåŠ¡å™¨æ“ä½œæ­¥éª¤

### 4.1 è§£å‹é¡¹ç›®æ–‡ä»¶

```bash
cd /www/projects/xinfu-project
tar -xzf /tmp/xinfu-project-full.tar.gz
rm /tmp/xinfu-project-full.tar.gz
```

### 4.2 å®‰è£…å¹¶é…ç½® Redis

```bash
# å®‰è£…Redis
yum install -y redis

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable redis
systemctl start redis

# éªŒè¯
redis-cli ping
# åº”è¿”å›ï¼šPONG
```

### 4.3 é…ç½®æ•°æ®åº“

#### 4.3.1 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
mysql -u root -p << 'MYSQL_EOF'
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS xinfu_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER IF NOT EXISTS 'xinfu_user'@'localhost' IDENTIFIED BY 'Xinfu2026@Secure';

-- æˆæƒ
GRANT ALL PRIVILEGES ON xinfu_db.* TO 'xinfu_user'@'localhost';
FLUSH PRIVILEGES;

-- éªŒè¯
SELECT user, host FROM mysql.user WHERE user='xinfu_user';
SHOW DATABASES LIKE 'xinfu_db';
MYSQL_EOF
```

#### 4.3.2 ä¿®æ­£SQLæ–‡ä»¶å¹¶å¯¼å…¥

**âš ï¸ é‡è¦ï¼šä¿®æ­£æ•°æ®åº“å**

```bash
cd /www/projects/xinfu-project/database

# å°†SQLæ–‡ä»¶ä¸­çš„ 'xingfuli' æ›¿æ¢ä¸º 'xinfu_db'
sed -i 's/xingfuli/xinfu_db/g' *.sql

# å¯¼å…¥æ‰€æœ‰SQLæ–‡ä»¶
for sql_file in *.sql; do
    if [ -f "$sql_file" ]; then
        echo "å¯¼å…¥: $sql_file"
        mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db < "$sql_file" 2>&1 | grep -v "Warning: Using a password"
    fi
done
```

#### 4.3.3 ä¿®å¤è¡¨ç»“æ„ä¸å…¼å®¹é—®é¢˜

**âš ï¸ å…³é”®ä¿®å¤ï¼šå­—æ®µåä¸åŒ¹é…**

```bash
mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db << 'MYSQL_EOF'
-- ä¿®å¤ match_detail è¡¨å­—æ®µå
ALTER TABLE match_detail 
CHANGE COLUMN result_detail match_data JSON NULL COMMENT 'åŒ¹é…è¯¦æƒ…æ•°æ®å¿«ç…§';

-- ä¿®å¤ match_batch è¡¨ï¼Œå…è®¸ created_by ä¸ºç©ºï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
ALTER TABLE match_batch 
MODIFY COLUMN created_by VARCHAR(20) NULL COMMENT 'æ“ä½œäººï¼ˆçº¢å¨˜IDï¼‰';
MYSQL_EOF

echo "âœ… æ•°æ®åº“ä¿®å¤å®Œæˆ"
```

#### 4.3.4 éªŒè¯æ•°æ®åº“

```bash
mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db -e "
SELECT table_name, table_rows 
FROM information_schema.tables 
WHERE table_schema = 'xinfu_db'
ORDER BY table_name;"
```

### 4.4 é…ç½®åç«¯

#### 4.4.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
cd /www/projects/xinfu-project/backend

cat > .env << 'ENV_EOF'
NODE_ENV=production
PORT=3001
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=xinfu_user
DB_PASSWORD=Xinfu2026@Secure
DB_DATABASE=xinfu_db
JWT_SECRET=xinfu-project-jwt-secret-$(date +%s)-secure
JWT_EXPIRES_IN=7d
CORS_ORIGIN=http://<æœåŠ¡å™¨IP>:8080,http://<æœåŠ¡å™¨IP>
ENV_EOF

# âš ï¸ è®°å¾—æ›¿æ¢ <æœåŠ¡å™¨IP> ä¸ºå®é™…IPåœ°å€
sed -i "s/<æœåŠ¡å™¨IP>/$(curl -s ifconfig.me)/g" .env
```

#### 4.4.2 å®‰è£…ä¾èµ–å¹¶æ„å»º

**âš ï¸ å†…å­˜ä¸è¶³å¤„ç†**

å¦‚æœæœåŠ¡å™¨å†…å­˜å°äº2GBï¼Œå…ˆåˆ›å»ºSwapï¼š

```bash
# æ£€æŸ¥å†…å­˜
free -h

# å¦‚æœå¯ç”¨å†…å­˜ < 500MBï¼Œåˆ›å»º2GB Swap
if [ $(free -m | grep Swap | awk '{print $2}') -lt 1024 ]; then
    dd if=/dev/zero of=/swapfile bs=1M count=2048
    chmod 600 /swapfile
    mkswap /swapfile
    swapon /swapfile
    echo "/swapfile swap swap defaults 0 0" >> /etc/fstab
    echo "âœ… Swap åˆ›å»ºå®Œæˆ"
fi
```

**æ„å»ºåç«¯**

```bash
cd /www/projects/xinfu-project/backend

# å®‰è£…ä¾èµ–
npm install --registry=https://registry.npmmirror.com

# æ„å»º
npm run build

# éªŒè¯æ„å»ºäº§ç‰©
ls -lh dist/main.js
```

### 4.5 æ„å»ºå‰ç«¯

#### 4.5.1 æ„å»ºç®¡ç†åå°

```bash
cd /www/projects/xinfu-project/frontend-admin

# å®‰è£…ä¾èµ–
npm install --registry=https://registry.npmmirror.com

# æ„å»ºï¼ˆè·³è¿‡ç±»å‹æ£€æŸ¥ï¼‰
./node_modules/.bin/vite build

# éªŒè¯
ls -lh dist/index.html
```

#### 4.5.2 æ„å»ºH5å‰å°

```bash
cd /www/projects/xinfu-project/frontend-h5

# å®‰è£…ä¾èµ–
npm install --registry=https://registry.npmmirror.com

# æ„å»º
./node_modules/.bin/vite build

# éªŒè¯
ls -lh dist/index.html
```

### 4.6 é…ç½®PM2

#### 4.6.1 åˆ›å»ºPM2é…ç½®æ–‡ä»¶

```bash
cd /www/projects/xinfu-project

cat > ecosystem.config.js << 'PM2_EOF'
module.exports = {
  apps: [{
    name: 'xinfu-backend',
    script: './dist/main.js',
    cwd: '/www/projects/xinfu-project/backend',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '512M',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    },
    error_file: '/www/projects/xinfu-project/logs/backend-error.log',
    out_file: '/www/projects/xinfu-project/logs/backend-out.log',
    time: true
  }]
};
PM2_EOF
```

#### 4.6.2 å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨
pm2 start ecosystem.config.js

# ä¿å­˜PM2è¿›ç¨‹åˆ—è¡¨
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—ï¼ˆç¡®è®¤æ— æŠ¥é”™ï¼‰
pm2 logs xinfu-backend --lines 20 --nostream
```

### 4.7 é…ç½®Nginx

#### 4.7.1 åˆ›å»ºNginxé…ç½®

```bash
cat > /etc/nginx/conf.d/xinfu-project.conf << 'NGINX_EOF'
upstream xinfu_backend {
    server 127.0.0.1:3001;
}

server {
    listen 8080;
    server_name _;
    
    # æ—¥å¿—
    access_log /var/log/nginx/xinfu-access.log;
    error_log /var/log/nginx/xinfu-error.log;
    
    # ç®¡ç†åå°
    location /admin {
        alias /www/projects/xinfu-project/frontend-admin/dist;
        try_files $uri $uri/ /admin/index.html;
        index index.html;
    }
    
    # H5å‰å°
    location /h5 {
        alias /www/projects/xinfu-project/frontend-h5/dist;
        try_files $uri $uri/ /h5/index.html;
        index index.html;
    }
    
    # åç«¯API
    location /api/ {
        proxy_pass http://xinfu_backend/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
    
    # æ ¹è·¯å¾„è·³è½¬åˆ°ç®¡ç†åå°
    location = / {
        return 301 /admin;
    }
}
NGINX_EOF
```

#### 4.7.2 å¯åŠ¨Nginx

```bash
# æµ‹è¯•é…ç½®
nginx -t

# å¯åŠ¨/é‡å¯Nginx
systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
systemctl status nginx
```

### 4.8 é…ç½®é˜²ç«å¢™ï¼ˆå¦‚æœå¯ç”¨ï¼‰

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
systemctl is-active firewalld

# å¦‚æœé˜²ç«å¢™å¯ç”¨ï¼Œå¼€æ”¾8080ç«¯å£
if systemctl is-active --quiet firewalld; then
    firewall-cmd --permanent --add-port=8080/tcp
    firewall-cmd --reload
    echo "âœ… é˜²ç«å¢™ç«¯å£8080å·²å¼€æ”¾"
fi
```

### 4.9 é…ç½®å¼€æœºè‡ªå¯åŠ¨

```bash
# MySQL
systemctl enable mysqld

# Redis
systemctl enable redis

# Nginx
systemctl enable nginx

# PM2
pm2 startup systemd -u root --hp /root
pm2 save

echo "âœ… æ‰€æœ‰æœåŠ¡å·²è®¾ç½®ä¸ºå¼€æœºè‡ªå¯"
```

---

## äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 å‰ç«¯404é”™è¯¯ï¼ˆèµ„æºåŠ è½½å¤±è´¥ï¼‰

**ç—‡çŠ¶ï¼š** æµè§ˆå™¨æ§åˆ¶å°æŠ¥é”™ `Failed to load resource: 404 (Not Found)`ï¼Œè·¯å¾„å¦‚ `/assets/index-xxx.js`

**åŸå› ï¼š** `vite.config.ts` ä¸­æœªè®¾ç½® `base` è·¯å¾„ï¼Œæˆ–æ„å»ºæ—¶æœªç”Ÿæ•ˆ

**è§£å†³ï¼š**
```bash
# 1. ç¡®è®¤ vite.config.ts ä¸­æœ‰ base é…ç½®
cat /www/projects/xinfu-project/frontend-admin/vite.config.ts | grep "base:"

# 2. æ£€æŸ¥æ„å»ºäº§ç‰©ä¸­çš„è·¯å¾„
head -10 /www/projects/xinfu-project/frontend-admin/dist/index.html

# åº”è¯¥çœ‹åˆ°ï¼šsrc="/admin/assets/..." è€Œä¸æ˜¯ src="/assets/..."

# 3. å¦‚æœè·¯å¾„ä¸å¯¹ï¼Œé‡æ–°é…ç½®å¹¶æ„å»º
cd /www/projects/xinfu-project/frontend-admin
# ä¿®æ”¹ vite.config.tsï¼ˆå‚è€ƒ 3.1èŠ‚ï¼‰
./node_modules/.bin/vite build
```

### 5.2 æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** PM2æ—¥å¿—æ˜¾ç¤º `Access denied for user 'xinfu_user'@'localhost'`

**è§£å†³ï¼š**
```bash
# é‡ç½®æ•°æ®åº“ç”¨æˆ·å¯†ç 
mysql -u root -p << 'MYSQL_EOF'
ALTER USER 'xinfu_user'@'localhost' IDENTIFIED BY 'Xinfu2026@Secure';
GRANT ALL PRIVILEGES ON xinfu_db.* TO 'xinfu_user'@'localhost';
FLUSH PRIVILEGES;
MYSQL_EOF

# é‡å¯åç«¯
pm2 restart xinfu-backend
```

### 5.3 æ™ºèƒ½åŒ¹é…500é”™è¯¯

**ç—‡çŠ¶ï¼š** ç‚¹å‡»"å‘èµ·åŒ¹é…"æŠ¥500é”™è¯¯ï¼Œæ—¥å¿—æ˜¾ç¤º `Unknown column 'details.match_data'` æˆ– `Field 'created_by' doesn't have a default value`

**è§£å†³ï¼š**
```bash
# æ‰§è¡Œä¿®å¤SQLï¼ˆå‚è€ƒ 4.3.3èŠ‚ï¼‰
mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db << 'MYSQL_EOF'
ALTER TABLE match_detail 
CHANGE COLUMN result_detail match_data JSON NULL;

ALTER TABLE match_batch 
MODIFY COLUMN created_by VARCHAR(20) NULL;
MYSQL_EOF

pm2 restart xinfu-backend
```

### 5.4 å†…å­˜ä¸è¶³å¯¼è‡´æ„å»ºå¡æ­»

**ç—‡çŠ¶ï¼š** `npm run build` æˆ– `vite build` é•¿æ—¶é—´æ— å“åº”

**è§£å†³ï¼š**
```bash
# 1. åœæ­¢æ‰€æœ‰å…¶ä»–æœåŠ¡é‡Šæ”¾å†…å­˜
pm2 stop all

# 2. åˆ›å»ºSwapï¼ˆå‚è€ƒ 4.4.2èŠ‚ï¼‰

# 3. é‡æ–°æ„å»º

# 4. æ„å»ºå®Œæˆåæ¢å¤æœåŠ¡
pm2 restart all
```

### 5.5 Redisè¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** åç«¯æ—¥å¿—æ˜¾ç¤º `Redis Client Error: connect ECONNREFUSED`

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥RedisçŠ¶æ€
systemctl status redis

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨Redis
systemctl start redis

# é‡å¯åç«¯
pm2 restart xinfu-backend
```

---

## å…­ã€éªŒè¯ä¸æµ‹è¯•

### 6.1 æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡
echo "=== MySQL ==="
systemctl status mysqld | head -5

echo "=== Redis ==="
systemctl status redis | head -5

echo "=== Nginx ==="
systemctl status nginx | head -5

echo "=== PM2 ==="
pm2 list

echo "=== ç«¯å£ç›‘å¬ ==="
ss -tuln | grep -E ':3001|:8080'
```

### 6.2 åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] **ç®¡ç†åå°ç™»å½•**
  - è®¿é—®ï¼š`http://<æœåŠ¡å™¨IP>:8080/admin`
  - è´¦å·ï¼š`super_admin`
  - å¯†ç ï¼š`admin123`

- [ ] **ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢**
  - è¿›å…¥"ç”¨æˆ·æ¡£æ¡ˆç®¡ç†" â†’ "ç”¨æˆ·åˆ—è¡¨"
  - ç¡®è®¤èƒ½çœ‹åˆ°ç”¨æˆ·æ•°æ®

- [ ] **æ™ºèƒ½åŒ¹é…åŠŸèƒ½**
  - è¿›å…¥"ç”¨æˆ·æ¡£æ¡ˆç®¡ç†" â†’ "æ™ºèƒ½åŒ¹é…"
  - é€‰æ‹©ç”¨æˆ· â†’ ç‚¹å‡»"å‘èµ·åŒ¹é…"
  - ç¡®è®¤æ— 500é”™è¯¯ï¼Œèƒ½çœ‹åˆ°åŒ¹é…ç»“æœ

- [ ] **H5å‰å°è®¿é—®**
  - è®¿é—®ï¼š`http://<æœåŠ¡å™¨IP>:8080/h5`
  - ç¡®è®¤é¦–é¡µæ­£å¸¸æ˜¾ç¤º

- [ ] **æœåŠ¡è½¨è¿¹**
  - è¿›å…¥ç”¨æˆ·è¯¦æƒ… â†’ "åŒ¹é…åé¦ˆ/çº¦è§è®°å½•/æ²»ç–—è®°å½•" Tab
  - ç¡®è®¤èƒ½æ­£å¸¸æ–°å¢å’ŒæŸ¥çœ‹è®°å½•

### 6.3 æ—¥å¿—æ£€æŸ¥

```bash
# åç«¯æ—¥å¿—
pm2 logs xinfu-backend --lines 50

# Nginxé”™è¯¯æ—¥å¿—
tail -50 /var/log/nginx/xinfu-error.log

# MySQLé”™è¯¯æ—¥å¿—
tail -50 /var/log/mysqld.log
```

---

## ä¸ƒã€è…¾è®¯äº‘å®‰å…¨ç»„é…ç½®

å¦‚æœä½¿ç”¨è…¾è®¯äº‘æœåŠ¡å™¨ï¼Œéœ€è¦åœ¨æ§åˆ¶å°å¼€æ”¾ç«¯å£ï¼š

1. ç™»å½• [è…¾è®¯äº‘æ§åˆ¶å°](https://console.cloud.tencent.com/)
2. è¿›å…¥ **äº‘æœåŠ¡å™¨ CVM** â†’ é€‰æ‹©å®ä¾‹ â†’ **å®‰å…¨ç»„**
3. ç‚¹å‡» **æ·»åŠ è§„åˆ™**ï¼š
   - **åè®®ç«¯å£**ï¼š`TCP:8080`
   - **æ¥æº**ï¼š`0.0.0.0/0`ï¼ˆå…è®¸æ‰€æœ‰IPè®¿é—®ï¼‰
   - **ç­–ç•¥**ï¼šå…è®¸
4. ä¿å­˜è§„åˆ™

---

## å…«ã€åç»­ç»´æŠ¤

### 8.1 æ—¥å¸¸è¿ç»´å‘½ä»¤

```bash
# æŸ¥çœ‹PM2è¿›ç¨‹
pm2 list

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs xinfu-backend

# é‡å¯åç«¯
pm2 restart xinfu-backend

# é‡å¯Nginx
systemctl restart nginx

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop  # æˆ– top
```

### 8.2 æ›´æ–°ä»£ç 

**æ›´æ–°åç«¯ï¼š**
```bash
# æœ¬åœ°æ„å»º
cd backend && npm run build

# æ‰“åŒ…dist
tar -czf backend-dist.tar.gz dist/

# ä¸Šä¼ 
scp backend-dist.tar.gz root@<IP>:/tmp/

# æœåŠ¡å™¨ä¸Šæ“ä½œ
cd /www/projects/xinfu-project/backend
tar -xzf /tmp/backend-dist.tar.gz
pm2 restart xinfu-backend
```

**æ›´æ–°å‰ç«¯ï¼š**
```bash
# æœ¬åœ°æ„å»º
cd frontend-admin && npm run build

# æ‰“åŒ…
tar -czf admin-dist.tar.gz dist/

# ä¸Šä¼ 
scp admin-dist.tar.gz root@<IP>:/tmp/

# æœåŠ¡å™¨ä¸Šæ“ä½œ
cd /www/projects/xinfu-project/frontend-admin
rm -rf dist
tar -xzf /tmp/admin-dist.tar.gz
```

### 8.3 å¤‡ä»½ç­–ç•¥

```bash
# æ•°æ®åº“å¤‡ä»½
mysqldump -u xinfu_user -p'Xinfu2026@Secure' xinfu_db > backup_$(date +%Y%m%d).sql

# ä»£ç å¤‡ä»½
cd /www/projects
tar -czf xinfu-project-backup-$(date +%Y%m%d).tar.gz xinfu-project/
```

---

## ä¹ã€å¿«é€Ÿéƒ¨ç½²è„šæœ¬ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º `quick-deploy.sh`ï¼Œèµ‹äºˆæ‰§è¡Œæƒé™åç›´æ¥è¿è¡Œï¼š

```bash
#!/bin/bash
set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "=========================================="
echo "ğŸš€ å¹¸ç¦åŠ›é¡¹ç›®ä¸€é”®éƒ¨ç½²è„šæœ¬"
echo "=========================================="

# 1. åˆ›å»ºç›®å½•
mkdir -p /www/projects/xinfu-project/{logs,database}

# 2. è§£å‹é¡¹ç›®
cd /www/projects/xinfu-project
tar -xzf /tmp/xinfu-project-full.tar.gz

# 3. å®‰è£…Redis
yum install -y redis
systemctl enable redis
systemctl start redis

# 4. é…ç½®æ•°æ®åº“
mysql -u root -p << 'MYSQL_EOF'
CREATE DATABASE IF NOT EXISTS xinfu_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER IF NOT EXISTS 'xinfu_user'@'localhost' IDENTIFIED BY 'Xinfu2026@Secure';
GRANT ALL PRIVILEGES ON xinfu_db.* TO 'xinfu_user'@'localhost';
FLUSH PRIVILEGES;
MYSQL_EOF

# 5. å¯¼å…¥SQL
cd database
sed -i 's/xingfuli/xinfu_db/g' *.sql
for sql_file in *.sql; do
    mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db < "$sql_file" 2>/dev/null
done

# 6. ä¿®å¤è¡¨ç»“æ„
mysql -u xinfu_user -p'Xinfu2026@Secure' -D xinfu_db << 'MYSQL_EOF'
ALTER TABLE match_detail CHANGE COLUMN result_detail match_data JSON NULL;
ALTER TABLE match_batch MODIFY COLUMN created_by VARCHAR(20) NULL;
MYSQL_EOF

# 7. é…ç½®åç«¯
cd ../backend
cat > .env << 'ENV_EOF'
NODE_ENV=production
PORT=3001
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=xinfu_user
DB_PASSWORD=Xinfu2026@Secure
DB_DATABASE=xinfu_db
JWT_SECRET=xinfu-project-jwt-secret-secure
JWT_EXPIRES_IN=7d
ENV_EOF

# 8. æ„å»ºåç«¯
npm install --registry=https://registry.npmmirror.com
npm run build

# 9. æ„å»ºå‰ç«¯
cd ../frontend-admin
npm install --registry=https://registry.npmmirror.com
./node_modules/.bin/vite build

cd ../frontend-h5
npm install --registry=https://registry.npmmirror.com
./node_modules/.bin/vite build

# 10. é…ç½®PM2
cd ..
cat > ecosystem.config.js << 'PM2_EOF'
module.exports = {
  apps: [{
    name: 'xinfu-backend',
    script: './dist/main.js',
    cwd: '/www/projects/xinfu-project/backend',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '512M',
    env: { NODE_ENV: 'production', PORT: 3001 },
    error_file: '/www/projects/xinfu-project/logs/backend-error.log',
    out_file: '/www/projects/xinfu-project/logs/backend-out.log',
    time: true
  }]
};
PM2_EOF

pm2 start ecosystem.config.js
pm2 save

# 11. é…ç½®Nginx
cat > /etc/nginx/conf.d/xinfu-project.conf << 'NGINX_EOF'
upstream xinfu_backend { server 127.0.0.1:3001; }
server {
    listen 8080;
    server_name _;
    access_log /var/log/nginx/xinfu-access.log;
    error_log /var/log/nginx/xinfu-error.log;
    location /admin {
        alias /www/projects/xinfu-project/frontend-admin/dist;
        try_files $uri $uri/ /admin/index.html;
        index index.html;
    }
    location /h5 {
        alias /www/projects/xinfu-project/frontend-h5/dist;
        try_files $uri $uri/ /h5/index.html;
        index index.html;
    }
    location /api/ {
        proxy_pass http://xinfu_backend/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
    location = / { return 301 /admin; }
}
NGINX_EOF

nginx -t
systemctl restart nginx

# 12. é…ç½®å¼€æœºè‡ªå¯
systemctl enable mysqld redis nginx
pm2 startup systemd -u root --hp /root
pm2 save

echo ""
echo "=========================================="
echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
echo "ğŸ“± è®¿é—®åœ°å€ï¼š"
echo "   ç®¡ç†åå°: http://$(curl -s ifconfig.me):8080/admin"
echo "   H5å‰å°:  http://$(curl -s ifconfig.me):8080/h5"
echo ""
echo "ğŸ”‘ é»˜è®¤è´¦å·ï¼š"
echo "   è´¦å·: super_admin"
echo "   å¯†ç : admin123"
echo "=========================================="
```

---

## åã€è”ç³»ä¸æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. PM2æ—¥å¿—ï¼š`pm2 logs xinfu-backend`
2. Nginxé”™è¯¯æ—¥å¿—ï¼š`tail -50 /var/log/nginx/xinfu-error.log`
3. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-20
