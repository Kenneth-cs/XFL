# 服务器环境分析报告

## 🖥️ 服务器基本信息
- **操作系统**: TencentOS Server 4 x86_64 (类CentOS)
- **Node.js**: v20.19.6 ✅
- **npm**: 10.8.2 ✅
- **MySQL**: 8.0.44 ✅
- **PM2**: 已安装 ✅
- **Nginx**: 未安装 ❌

## 📦 系统资源
- **磁盘**: 50GB (已用 8.7GB, 可用 42GB, 使用率 18%) ✅ 充足
- **内存**: 1.9GB (已用 1.1GB, 可用 876MB) ⚠️ 较小，需注意优化

## 🔌 端口占用情况

### 已占用端口
| 端口 | 服务 | 进程 | 说明 |
|------|------|------|------|
| 22 | SSH | sshd | 系统服务 |
| 80 | HTTP | python3 | 其他项目占用 |
| 3000 | Next.js | badminton-booking | 羽毛球预订项目 |
| 3306 | MySQL | mysqld | 数据库 |
| 33060 | MySQL X | mysqld | MySQL协议 |

### 可用端口（建议）
- **后端API**: 3001 或 3002
- **前端开发服务器（不需要）**: 生产环境直接构建静态文件
- **Nginx**: 需要安装并配置（将占用80或其他端口）

## 🚀 现有项目
1. **badminton-booking** (羽毛球预订系统)
   - 运行时间: 21天
   - 端口: 3000
   - 管理: PM2
   - 状态: online

## ⚠️ 注意事项
1. **80端口被占用**: Python进程占用，需要：
   - 查明该Python服务的用途
   - 考虑使用其他端口或配置Nginx多站点反向代理
   
2. **内存较小**: 1.9GB内存运行多个Node.js项目可能吃紧，建议：
   - 监控内存使用
   - 优化Node.js进程数量
   - 考虑使用集群模式时谨慎配置

3. **安全问题**: 
   - 6688次失败登录尝试，建议加强SSH安全配置
   - 考虑配置fail2ban
   - 修改SSH默认端口

## 🎯 部署方案

### 端口分配
- **幸福力后端API**: 3001
- **管理后台前端**: 通过Nginx提供 (80端口/admin路径 或 独立端口)
- **H5前台**: 通过Nginx提供 (80端口/h5路径 或 独立端口)

### Nginx配置方案
由于80端口被占用，有两种方案：

**方案A: 停止现有Python服务，Nginx独占80端口**
- 优点: 标准HTTP端口，用户体验好
- 缺点: 需要停止或迁移现有服务

**方案B: Nginx使用其他端口（如8080），Python保留80**
- 优点: 不影响现有服务
- 缺点: 访问需要带端口号

**推荐**: 先使用方案B部署，确认新项目正常后再考虑方案A

### 部署目录结构
```
/www/projects/xinfu-project/
├── backend/               # 后端API
├── frontend-admin/        # 管理后台
├── frontend-h5/           # H5前台
├── logs/                  # 日志目录
└── ecosystem.config.js    # PM2配置
```

## 📋 部署步骤总览
1. ✅ 环境检查完成
2. ⏭️ 创建部署目录
3. ⏭️ 上传项目文件
4. ⏭️ 配置数据库
5. ⏭️ 安装依赖并构建
6. ⏭️ 配置PM2启动后端
7. ⏭️ 安装并配置Nginx
8. ⏭️ 配置防火墙和安全组
9. ⏭️ 测试验证
