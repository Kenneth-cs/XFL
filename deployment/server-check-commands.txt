# è¯·åœ¨æ‚¨çš„æœåŠ¡å™¨ç»ˆç«¯ä¸­å¤åˆ¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
# ========================================
# æœåŠ¡å™¨ç¯å¢ƒæ£€æŸ¥å‘½ä»¤é›†
# ========================================

# 1. æ£€æŸ¥æ‰€æœ‰ç›‘å¬ç«¯å£
echo "=========================================="
echo "ğŸ“Œ 1. å·²å ç”¨çš„ç«¯å£åˆ—è¡¨:"
echo "=========================================="
ss -tuln | grep LISTEN | awk '{print $5}' | sed 's/.*://' | sort -n | uniq

echo ""
echo "=========================================="
echo "ğŸ“Œ 2. è¯¦ç»†ç«¯å£å ç”¨æƒ…å†µ (åŒ…å«è¿›ç¨‹ä¿¡æ¯):"
echo "=========================================="
ss -tulnp | grep LISTEN

echo ""
echo "=========================================="
echo "ğŸ“Œ 3. è¿è¡Œä¸­çš„ Node.js è¿›ç¨‹:"
echo "=========================================="
ps aux | grep -E 'node|npm' | grep -v grep

echo ""
echo "=========================================="
echo "ğŸ“Œ 4. PM2 è¿›ç¨‹åˆ—è¡¨:"
echo "=========================================="
if command -v pm2 &> /dev/null; then
    pm2 list
else
    echo "PM2 æœªå®‰è£…"
fi

echo ""
echo "=========================================="
echo "ğŸ“Œ 5. Nginx çŠ¶æ€:"
echo "=========================================="
if command -v nginx &> /dev/null; then
    nginx -v
    systemctl status nginx --no-pager | head -15
    echo ""
    echo "Nginx é…ç½®æ–‡ä»¶:"
    ls -lh /etc/nginx/conf.d/ 2>/dev/null
    ls -lh /etc/nginx/sites-enabled/ 2>/dev/null
else
    echo "Nginx æœªå®‰è£…"
fi

echo ""
echo "=========================================="
echo "ğŸ“Œ 6. MySQL/MariaDB çŠ¶æ€:"
echo "=========================================="
if command -v mysql &> /dev/null; then
    mysql --version
    systemctl status mysqld --no-pager 2>/dev/null | head -10 || systemctl status mariadb --no-pager 2>/dev/null | head -10
else
    echo "MySQL/MariaDB æœªå®‰è£…"
fi

echo ""
echo "=========================================="
echo "ğŸ“Œ 7. Node.js å’Œ npm ç‰ˆæœ¬:"
echo "=========================================="
if command -v node &> /dev/null; then
    node -v
    npm -v
    which node
else
    echo "Node.js æœªå®‰è£…"
fi

echo ""
echo "=========================================="
echo "ğŸ“Œ 8. éƒ¨ç½²ç›®å½•ç»“æ„:"
echo "=========================================="
echo "--- /var/www ---"
ls -lh /var/www 2>/dev/null || echo "ç›®å½•ä¸å­˜åœ¨"
echo ""
echo "--- /home ---"
ls -lh /home 2>/dev/null
echo ""
echo "--- /root ---"
ls -lh /root | head -10
echo ""
echo "--- /opt ---"
ls -lh /opt 2>/dev/null

echo ""
echo "=========================================="
echo "ğŸ“Œ 9. ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ:"
echo "=========================================="
echo "--- ç£ç›˜ ---"
df -h | grep -E 'Filesystem|/dev/'
echo ""
echo "--- å†…å­˜ ---"
free -h
echo ""
echo "--- CPU ---"
top -bn1 | head -20

echo ""
echo "=========================================="
echo "âœ… æ£€æŸ¥å®Œæˆï¼"
echo "=========================================="
