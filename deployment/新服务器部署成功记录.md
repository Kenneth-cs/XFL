# æ–°æœåŠ¡å™¨éƒ¨ç½²æˆåŠŸè®°å½•

**éƒ¨ç½²æ—¥æœŸ**: 2026-01-28  
**æœåŠ¡å™¨**: è…¾è®¯äº‘ Ubuntu 24.04 LTS  
**å…¬ç½‘IP**: 124.222.88.25

---

## âœ… éƒ¨ç½²å®Œæˆé¡¹

### 1. ç³»ç»Ÿç¯å¢ƒ
- âœ… Ubuntu 24.04 LTS
- âœ… Node.js 20.x
- âœ… PM2 (è¿›ç¨‹ç®¡ç†)
- âœ… Nginx (WebæœåŠ¡å™¨)
- âœ… MySQL 8.0

### 2. æ•°æ®åº“
- âœ… æ•°æ®åº“åç§°: `xinfu_db`
- âœ… æ•°æ®åº“ç”¨æˆ·: `xinfu_user`
- âœ… å¯†ç : `Xinfu@2024`
- âœ… æ•°æ®å·²ä»æ—§æœåŠ¡å™¨è¿ç§» (`xinfu_db_backup_20260123.sql`)

### 3. é¡¹ç›®éƒ¨ç½²
- âœ… åç«¯ (NestJS) - è¿è¡Œåœ¨ 3001 ç«¯å£
- âœ… å‰ç«¯-ç®¡ç†åå° (Vue 3 + Ant Design)
- âœ… å‰ç«¯-H5é¡µé¢ (Vue 3 + Vant)
- âœ… Nginx åå‘ä»£ç† - 8080 ç«¯å£

### 4. PM2 è¿›ç¨‹ç®¡ç†
```bash
pm2 status
# xinfu-backend: online âœ…
```

---

## ğŸŒ è®¿é—®åœ°å€

| é¡¹ç›® | åœ°å€ |
|------|------|
| åå°ç®¡ç† | http://124.222.88.25:8080/admin |
| H5å‰å° | http://124.222.88.25:8080/h5 |
| APIæ¥å£ | http://124.222.88.25:8080/api |

---

## ğŸ”‘ ç™»å½•å‡­è¯

### åå°ç®¡ç†å‘˜
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

### æ•°æ®åº“
- Host: `localhost`
- Port: `3306`
- Database: `xinfu_db`
- Username: `xinfu_user`
- Password: `Xinfu@2024`

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
/www/projects/xinfu-project/
â”œâ”€â”€ backend/                 # åç«¯ (NestJS)
â”‚   â”œâ”€â”€ dist/               # ç¼–è¯‘åçš„æ–‡ä»¶
â”‚   â”œâ”€â”€ src/                # æºä»£ç 
â”‚   â””â”€â”€ .env                # ç¯å¢ƒå˜é‡
â”œâ”€â”€ frontend-admin/         # ç®¡ç†åå°
â”‚   â””â”€â”€ dist/               # æ„å»ºåçš„é™æ€æ–‡ä»¶
â”œâ”€â”€ frontend-h5/            # H5å‰å°
â”‚   â””â”€â”€ dist/               # æ„å»ºåçš„é™æ€æ–‡ä»¶
â””â”€â”€ ecosystem.config.js     # PM2 é…ç½®æ–‡ä»¶
```

---

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 (åç«¯è¿›ç¨‹ç®¡ç†)
```bash
pm2 status                 # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 logs xinfu-backend     # æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 restart xinfu-backend  # é‡å¯åç«¯
pm2 stop xinfu-backend     # åœæ­¢åç«¯
pm2 save                   # ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 startup                # è®¾ç½®å¼€æœºè‡ªå¯
```

### Nginx (WebæœåŠ¡å™¨)
```bash
systemctl status nginx     # æŸ¥çœ‹NginxçŠ¶æ€
systemctl restart nginx    # é‡å¯Nginx
systemctl reload nginx     # é‡æ–°åŠ è½½é…ç½®
nginx -t                   # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
tail -f /var/log/nginx/error.log    # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/access.log   # æŸ¥çœ‹è®¿é—®æ—¥å¿—
```

### MySQL (æ•°æ®åº“)
```bash
systemctl status mysql     # æŸ¥çœ‹MySQLçŠ¶æ€
mysql -u xinfu_user -p     # ç™»å½•æ•°æ®åº“
# å¯†ç : Xinfu@2024

# å¤‡ä»½æ•°æ®åº“
mysqldump -u xinfu_user -p xinfu_db > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u xinfu_user -p xinfu_db < backup_20260128.sql
```

### ç³»ç»Ÿç›‘æ§
```bash
df -h                      # æŸ¥çœ‹ç£ç›˜ç©ºé—´
free -h                    # æŸ¥çœ‹å†…å­˜ä½¿ç”¨
top                        # æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop                       # æ›´å‹å¥½çš„èµ„æºç›‘æ§ (éœ€å®‰è£…)
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨æ›´æ–°
```bash
# 1. æœ¬åœ°æ‰“åŒ…
cd /Users/cs/Desktop/CS/åˆ›ä¸š/ç›¸äº²é¡¹ç›®å¼€å‘/å¹¸ç¦åŠ›é¡¹ç›®å¼€å‘
tar -czf xinfu-update-$(date +%Y%m%d_%H%M%S).tar.gz \
  --exclude='node_modules' \
  --exclude='.git' \
  backend frontend-admin frontend-h5

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp xinfu-update-*.tar.gz ubuntu@124.222.88.25:/tmp/

# 3. æœåŠ¡å™¨ç«¯æ“ä½œ
ssh ubuntu@124.222.88.25
sudo su -
cd /www/projects/xinfu-project
tar -xzf /tmp/xinfu-update-*.tar.gz
cd backend && npm install && npm run build
cd ../frontend-admin && npm install && npm run build
cd ../frontend-h5 && npm install && npm run build
pm2 restart xinfu-backend
systemctl reload nginx
```

### æ–¹å¼äºŒï¼šGit éƒ¨ç½² (æ¨è)
```bash
# å¦‚æœé¡¹ç›®å·²æ¨é€åˆ° Git ä»“åº“
cd /www/projects/xinfu-project
git pull origin main
cd backend && npm install && npm run build
cd ../frontend-admin && npm install && npm run build
cd ../frontend-h5 && npm install && npm run build
pm2 restart xinfu-backend
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. âœ… **é˜²ç«å¢™é…ç½®**
   - ä»…å¼€æ”¾å¿…è¦ç«¯å£: 22 (SSH), 8080 (Web)
   - å®šæœŸæ£€æŸ¥å®‰å…¨ç»„è§„åˆ™

2. âš ï¸ **å¾…åŠ å¼ºé¡¹**
   - [ ] é…ç½® HTTPS (Let's Encrypt)
   - [ ] ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
   - [ ] é…ç½®æ•°æ®åº“å®šæœŸå¤‡ä»½
   - [ ] å¯ç”¨ fail2ban é˜²æš´åŠ›ç ´è§£
   - [ ] é…ç½®æ—¥å¿—è½®è½¬ (logrotate)

3. ğŸ“¦ **å¤‡ä»½ç­–ç•¥**
   ```bash
   # å»ºè®®æ¯å¤©è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
   crontab -e
   # æ·»åŠ : 0 2 * * * mysqldump -u xinfu_user -pXinfu@2024 xinfu_db > /backup/xinfu_$(date +\%Y\%m\%d).sql
   ```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å½“å‰èµ„æºä½¿ç”¨
- åç«¯å†…å­˜: ~85.7 MB
- Nginx å†…å­˜: ~2.6 MB
- MySQL: (æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µç›‘æ§)

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
- [ ] å¯ç”¨ Nginx gzip å‹ç¼©
- [ ] é…ç½®å‰ç«¯é™æ€èµ„æºç¼“å­˜
- [ ] MySQL æŸ¥è¯¢ä¼˜åŒ– (æ ¹æ®æ…¢æŸ¥è¯¢æ—¥å¿—)
- [ ] è€ƒè™‘æ·»åŠ  Redis ç¼“å­˜

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### 1. åç«¯æ— æ³•å¯åŠ¨
```bash
pm2 logs xinfu-backend --lines 100    # æŸ¥çœ‹æ—¥å¿—
cd /www/projects/xinfu-project/backend
cat .env                                # æ£€æŸ¥ç¯å¢ƒå˜é‡
mysql -u xinfu_user -p                  # æµ‹è¯•æ•°æ®åº“è¿æ¥
```

### 2. å‰ç«¯é¡µé¢ 404
```bash
ls -la /www/projects/xinfu-project/frontend-admin/dist/
ls -la /www/projects/xinfu-project/frontend-h5/dist/
nginx -t                                # æ£€æŸ¥Nginxé…ç½®
tail -f /var/log/nginx/error.log       # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```

### 3. API è¯·æ±‚ 500 é”™è¯¯
```bash
pm2 logs xinfu-backend                 # æŸ¥çœ‹åç«¯é”™è¯¯æ—¥å¿—
mysql -u root -p                       # æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„
SHOW TABLES;
DESCRIBE table_name;
```

---

## ğŸ“ åç»­ä¼˜åŒ–è®¡åˆ’

1. **çŸ­æœŸ (1å‘¨å†…)**
   - [ ] é…ç½® HTTPS è¯ä¹¦
   - [ ] è®¾ç½®æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
   - [ ] æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–

2. **ä¸­æœŸ (1ä¸ªæœˆå†…)**
   - [ ] é…ç½®åŸŸåè§£æ
   - [ ] æ·»åŠ ç›‘æ§å‘Šè­¦ (å¦‚ PM2-monitor)
   - [ ] ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•

3. **é•¿æœŸ**
   - [ ] è€ƒè™‘ä½¿ç”¨ Docker éƒ¨ç½²
   - [ ] å®ç° CI/CD è‡ªåŠ¨éƒ¨ç½²
   - [ ] è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨æ¶æ„

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**é¡¹ç›®è·¯å¾„**: `/www/projects/xinfu-project`  
**éƒ¨ç½²æ–‡æ¡£**: `deployment/æ‰‹åŠ¨éƒ¨ç½²åˆ°æ–°æœåŠ¡å™¨.md`  
**å¿«é€ŸæŒ‡å—**: `deployment/QUICK-DEPLOY-æ–°æœåŠ¡å™¨.md`

---

**éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ  
**æœ€åæ›´æ–°**: 2026-01-28
