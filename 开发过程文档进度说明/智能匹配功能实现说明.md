# 智能匹配功能实现说明

## 1. 功能概述
本功能实现了基于用户MV值和九型人格的智能匹配系统，支持门店数据隔离、多维度筛选、自动排除已服务用户，并按批次展示匹配结果。

## 2. 核心模块
### 后端 (Backend)
- **Module**: `MatchModule`
- **Entities**:
  - `MatchBatch`: 存储匹配批次信息（发起人、筛选条件、时间）。
  - `MatchDetail`: 存储候选人匹配详情（MV分差、九型重合度、是否通过）。
  - `ServiceTrack`: 存储服务轨迹（用于排除已服务用户）。
- **Service**: `MatchService`
  - **initiateMatch**: 执行匹配核心逻辑。
    1. **门店隔离**: 仅筛选同门店用户。
    2. **基础筛选**: 性别、年龄、身高、学历。
    3. **排除逻辑**: 查询 `service_track` 表，排除已有服务记录的用户。
    4. **MV匹配**: 计算分差，|差值| ≤ 5 为通过。
    5. **九型匹配**: 使用 `checkEnneagramMatch` 工具，计算是否互斥及重合度。
    6. **保存结果**: 生成批次和明细记录。
  - **getMatches**: 分页查询匹配批次，支持发起人/候选人多维度搜索。

### 前端 (Frontend Admin)
- **列表页**: `src/views/members/MembersMatch.vue`
  - 功能：发起匹配、多条件查询、按批次展示结果。
  - 交互：发起匹配弹窗支持搜索发起人、设置筛选条件。
- **详情页**: `src/views/members/MatchDetail.vue`
  - 功能：左右分栏展示发起方与候选方详细档案，直观对比匹配结果。
- **组件**: `UserProfileView.vue`
  - 功能：复用展示用户基础信息、MV值、九型人格等。

## 3. 数据库变更
新增表结构（已自动同步）：
- `match_batch`
- `match_detail`
- `service_track`

## 4. 关键逻辑检查点
- **九型匹配**: 实现了 9x9 矩阵匹配，包含互斥（-1分）一票否决逻辑。
- **MV计算**: 复用现有 `AppUserProfile` 中的 `mvScore`。
- **数据关联**: 修正了 `AppUser` 与 `AppUserProfile` 的 OneToOne 关联，确保查询时能自动加载档案。

