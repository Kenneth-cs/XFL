# MV值学历字段修复说明

## 📅 更新时间
2026-01-21 23:31

## 🐛 问题描述

用户报告：**学历"一本"显示0分**

```json
{
  "education": {
    "value": "一本",
    "score": 0,
    "label": "无匹配规则"
  }
}
```

## 🔍 问题分析

### 根本原因：学历字段表述不统一

项目中存在**三种学历选项体系**：

1. **前端H5注册页面**（`frontend-h5/src/views/RegisterView.vue`）
   ```javascript
   const educationColumns = [
     { text: '高中及以下', value: '高中及以下' },
     { text: '大专', value: '大专' },
     { text: '本科', value: '本科' },        // ← 注意
     { text: '硕士', value: '硕士' },        // ← 注意
     { text: '博士', value: '博士' }         // ← 注意
   ]
   ```

2. **管理后台**（`frontend-admin/src/constants/member-options.ts`）
   ```typescript
   export const EDUCATION_OPTIONS = [
     '大专以下',
     '大专',
     '二本',
     '普通一本',                              // ← 注意
     '211大学',
     '985或更高'                             // ← 注意
   ]
   ```

3. **后端MV计算规则**（`backend/src/constants/mv-rules.constant.ts`）
   - **修复前**：只匹配管理后台的选项
   - **问题**：H5用户填"本科" → 无法匹配 → 0分

### 问题影响

| 用户来源 | 填写值 | 修复前得分 | 修复后得分 |
|---------|-------|-----------|-----------|
| 管理后台 | 一本 | ❌ 0分 | ✅ 10.5分 |
| 管理后台 | 普通一本 | ✅ 10.5分 | ✅ 10.5分 |
| H5注册 | 本科 | ❌ 0分 | ✅ 10.5分 |
| H5注册 | 硕士 | ❌ 0分 | ✅ 12.5分 |
| H5注册 | 博士 | ❌ 0分 | ✅ 12.5分 |

## ✅ 修复方案

### 扩展学历匹配规则，兼容所有表述方式

**文件**：`backend/src/constants/mv-rules.constant.ts`

**修改范围**：
- 所有5个地域方案（上海北京、广深杭、成都重庆武汉、东北三省、全国普适）
- 女性学历维度 `[FemaleMvDimension.EDUCATION]`
- 男性智商维度 `[MaleMvDimension.INTELLIGENCE]`

### 修复前代码

```typescript
[FemaleMvDimension.EDUCATION]: [
  { condition: (e) => e === '大专以下', score: 6.5, label: '大专以下' },
  { condition: (e) => e === '大专', score: 8.5, label: '大专' },
  { condition: (e) => e === '二本', score: 9.5, label: '二本' },
  { condition: (e) => e === '普通一本', score: 10.5, label: '普通一本' },  // ❌ 只匹配"普通一本"
  { condition: (e) => e === '211大学', score: 11.5, label: '211大学' },
  { condition: (e) => e === '985或更高', score: 12.5, label: '985或更高' }  // ❌ 只匹配"985或更高"
]
```

### 修复后代码

```typescript
[FemaleMvDimension.EDUCATION]: [
  // ✅ 兼容：大专以下、高中及以下
  { condition: (e) => e === '大专以下' || e === '高中及以下', score: 6.5, label: '大专以下' },
  { condition: (e) => e === '大专', score: 8.5, label: '大专' },
  { condition: (e) => e === '二本', score: 9.5, label: '二本' },
  // ✅ 兼容：普通一本、一本、本科
  { condition: (e) => e === '普通一本' || e === '一本' || e === '本科', score: 10.5, label: '普通一本' },
  { condition: (e) => e === '211大学', score: 11.5, label: '211大学' },
  // ✅ 兼容：985或更高、硕士、博士
  { condition: (e) => e === '985或更高' || e === '硕士' || e === '博士', score: 12.5, label: '985或更高' }
]
```

### 完整学历评分规则（修复后）

| 学历档次 | 支持的表述 | 女性得分 | 男性得分 |
|---------|-----------|---------|---------|
| **低** | 大专以下、高中及以下 | 6.5分 | 8.5分 |
| **中低** | 大专 | 8.5分 | 8.5分 |
| **中** | 二本 | 9.5分 | 9.5分 |
| **中高** | **普通一本、一本、本科** | **10.5分** | **10.5分** |
| **高** | 211大学 | 11.5分 | 11.5分 |
| **最高** | **985或更高、硕士、博士** | **12.5分** | **12.5分** |

## 📊 修复效果验证

### 测试案例1：王芳（一本）

**用户信息**：
- 用户ID：XFL00100003
- 性别：女
- 学历：一本
- 地域方案：上海北京

**修复前**：
```json
{
  "education": {
    "value": "一本",
    "score": 0,          // ❌
    "label": "无匹配规则"
  }
}
```

**修复后**：
```json
{
  "education": {
    "value": "一本",
    "score": 10.5,       // ✅
    "label": "普通一本"
  }
}
```

**MV总分变化**：
- 修复前：81.5分（学历0分）
- 修复后：**92.0分**（学历10.5分） ✅
- 提升：**+10.5分**

### 测试案例2：H5注册用户（本科）

**场景**：用户通过H5前台注册，选择学历"本科"

**修复前**：
```json
{
  "education": {
    "value": "本科",
    "score": 0,          // ❌
    "label": "无匹配规则"
  }
}
```

**修复后**：
```json
{
  "education": {
    "value": "本科",
    "score": 10.5,       // ✅
    "label": "普通一本"
  }
}
```

## 🎯 影响范围

### 地域方案
✅ 所有5个地域方案均已修复：
1. 上海北京地区
2. 广深杭地区
3. 成都重庆武汉地区
4. 东北三省地区
5. 全国普适版

### 用户类型
✅ 男性和女性用户均已修复：
- 女性：`FemaleMvDimension.EDUCATION`（学历维度）
- 男性：`MaleMvDimension.INTELLIGENCE`（智商维度）

### 数据来源
✅ 所有数据来源均兼容：
- 管理后台录入的用户
- H5前台注册的用户
- 历史导入的数据

## 🧪 测试建议

### 测试步骤
1. 刷新管理后台页面（Ctrl+F5 或 Cmd+Shift+R）
2. 进入王芳用户档案（XFL00100003）
3. 点击"重新计算"按钮
4. 查看MV明细：
   - 学历应该显示：一本，10.5分，(普通一本)
   - 总分应该约为：92分（之前81.5分）

### 预期结果
- ✅ 学历从"无匹配规则"变为"普通一本"
- ✅ 学历得分从0分变为10.5分
- ✅ MV总分提升约10.5分
- ✅ 不同来源的"本科"/"一本"/"普通一本"用户统一得10.5分

## 📚 相关文档

- MV值计算方案：`匹配相关/MV值分地域计算方案及结果计算说明.md`
- MV值计算代码更新：`匹配相关/MV值计算代码更新说明.md`
- 前端显示修复：`匹配相关/MV值前端显示修复说明.md`

## 🚀 部署状态

- ✅ 后端代码已修复
- ✅ 后端已重新构建（`npm run build`）
- ✅ 后端服务已重启
- ✅ 端口：http://localhost:3000/api/v1
- ✅ 状态：运行中

## 👤 修复人
AI Assistant

## ✍️ 审核
待用户确认
