# 婚况字段选项补充修复说明

## 📋 问题描述

用户反馈婚况字段选项不完整，当前只有：
- ❌ 未婚
- ❌ 离异（过于笼统）
- ❌ 丧偶

**应该包含的完整选项**（根据PRD需求）：
- ✅ 未婚
- ✅ **离异未育**（新增）
- ✅ **离异带孩**（新增）
- ✅ 丧偶

## 🎯 需要修改的位置

### 1. 前台H5注册页面
**文件**: `frontend-h5/src/views/RegisterView.vue`

**当前代码**（需修改）：
```typescript
const marriageOptions = [
  { text: '未婚', value: '未婚' },
  { text: '离异', value: '离异' },  // ❌ 太笼统
  { text: '丧偶', value: '丧偶' }
]
```

**修改为**：
```typescript
const marriageOptions = [
  { text: '未婚', value: '未婚' },
  { text: '离异未育', value: '离异未育' },  // ✅ 新增
  { text: '离异带孩', value: '离异带孩' },  // ✅ 新增
  { text: '丧偶', value: '丧偶' }
]
```

### 2. 管理后台用户档案编辑页面
**文件**: `frontend-admin/src/views/members/MemberDetail.vue`

找到婚况字段的 `a-select` 组件，将选项更新为：

```vue
<a-form-item label="婚况">
  <a-select v-model:value="formState.baseInfo.marriage">
    <a-select-option value="未婚">未婚</a-select-option>
    <a-select-option value="离异未育">离异未育</a-select-option>
    <a-select-option value="离异带孩">离异带孩</a-select-option>
    <a-select-option value="丧偶">丧偶</a-select-option>
  </a-select>
</a-form-item>
```

### 3. 类型定义文件（如果存在）
**文件**: `frontend-h5/src/types/user.ts` 或 `frontend-admin/src/types/user.ts`

如果有婚况的类型定义，更新为：
```typescript
export type MarriageStatus = '未婚' | '离异未育' | '离异带孩' | '丧偶';
```

### 4. 后端DTO验证（可选）
**文件**: `backend/src/modules/user/dto/create-app-user.dto.ts`

如果有枚举验证，更新为：
```typescript
@IsIn(['未婚', '离异未育', '离异带孩', '丧偶'], {
  message: '婚况选项不正确'
})
marriage: string;
```

## 🔧 完整修改步骤

### 第一步：修改前台H5注册页面

```bash
# 打开文件
frontend-h5/src/views/RegisterView.vue
```

在文件中找到 `marriageOptions` 的定义（大约在300-350行左右），修改为：

```typescript
const marriageOptions = [
  { text: '未婚', value: '未婚' },
  { text: '离异未育', value: '离异未育' },
  { text: '离异带孩', value: '离异带孩' },
  { text: '丧偶', value: '丧偶' }
]
```

### 第二步：修改管理后台档案编辑页面

```bash
# 打开文件
frontend-admin/src/views/members/MemberDetail.vue
```

找到婚况字段的表单项（大约在200-300行之间），修改 `a-select-option` 列表：

```vue
<!-- 在 "基础信息" 的 a-descriptions 或 a-form 中找到婚况字段 -->
<a-form-item label="婚况">
  <a-select 
    v-model:value="formState.baseInfo.marriage"
    placeholder="请选择婚况"
  >
    <a-select-option value="未婚">未婚</a-select-option>
    <a-select-option value="离异未育">离异未育</a-select-option>
    <a-select-option value="离异带孩">离异带孩</a-select-option>
    <a-select-option value="丧偶">丧偶</a-select-option>
  </a-select>
</a-form-item>
```

### 第三步：更新文档

**文件**: `信息收集/前台用户注册时需填的个人信息.md`

更新婚况说明：
```markdown
1.9 婚况（选择题，下拉可选）
选项：未婚、离异未育、离异带孩、丧偶
```

**文件**: `信息收集/用户档案模块信息字段及说明.md`

同步更新婚况字段说明。

## 📊 数据兼容性处理

### 历史数据迁移

如果数据库中已经存在"离异"的记录，需要进行数据清理：

```sql
-- 检查现有数据
SELECT marriage, COUNT(*) as count 
FROM app_user_profile 
WHERE JSON_UNQUOTE(JSON_EXTRACT(base_info, '$.marriage')) = '离异'
GROUP BY marriage;

-- 如果有"离异"的记录，需要人工判断或提示用户重新选择
-- 临时方案：可以将"离异"统一修改为"离异未育"
UPDATE app_user_profile 
SET base_info = JSON_SET(
  base_info, 
  '$.marriage', 
  '离异未育'
)
WHERE JSON_UNQUOTE(JSON_EXTRACT(base_info, '$.marriage')) = '离异';
```

**注意**: 建议在后台添加提示，让已选择"离异"的用户重新选择更具体的选项。

## 🧪 测试验证

### 前台注册测试
1. 访问H5注册页面
2. 填写基础信息，点击婚况下拉框
3. ✅ 应该看到4个选项：未婚、离异未育、离异带孩、丧偶
4. 选择任意一个，完成注册
5. 验证数据库中保存正确

### 后台档案编辑测试
1. 登录管理后台
2. 进入用户档案详情页
3. 点击编辑基础信息
4. 修改婚况字段
5. ✅ 下拉框应显示4个完整选项
6. 保存后刷新页面，验证显示正确

### 数据一致性测试
1. 在H5注册时选择"离异带孩"
2. 在管理后台查看该用户档案
3. ✅ 婚况显示为"离异带孩"
4. 在后台编辑并修改为"未婚"
5. H5用户资料页应同步更新为"未婚"

## 📝 相关文档更新

需要同步更新以下文档：

- ✅ `信息收集/前台用户注册时需填的个人信息.md`
- ✅ `信息收集/用户档案模块信息字段及说明.md`
- ✅ `项目核心文档/PRD_幸福力项目_v1.0.md`（如果有婚况字段说明）
- ✅ `项目核心文档/系统架构与数据库设计_幸福力项目_v1.0.md`（字段说明部分）

## ⚠️ 注意事项

1. **保持一致性**: 确保前台H5、管理后台、数据库、文档中的婚况选项完全一致
2. **历史数据**: 如果有用户已选择了旧的"离异"选项，需要提示他们更新
3. **显示逻辑**: 在用户列表、匹配结果等所有显示婚况的地方，都要能正确显示这4个选项
4. **搜索筛选**: 如果有按婚况筛选用户的功能，也要更新筛选条件选项

## 🎯 预期效果

修改完成后：
- ✅ 用户注册时可以选择更精确的婚况状态
- ✅ 管理后台可以准确记录和显示用户婚况
- ✅ 提升用户信息的准确性，有利于匹配算法
- ✅ 符合PRD需求规范

---

**修复日期**: 2026-01-23  
**相关Issue**: 婚况字段选项不完整  
**影响模块**: 前台注册、用户档案、匹配筛选
