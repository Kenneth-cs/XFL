import{d as te,n as ae,r as D,a as O,o as ne,c as h,e as o,f as u,w as a,g as R,h as oe,l as v,s as f,j as _,F as se,k as re,v as le,S as ie,t as y,u as ue,i as d,_ as de}from"./index-C1RCBxAK.js";const ce={class:"members-list"},pe={key:0},fe={key:1},_e={key:3},me=te({__name:"MembersList",setup(ge){const Y=ue(),j=JSON.parse(localStorage.getItem("admin_user")||"{}"),b=ae(()=>j.role==="super_admin"),I=D(!1),C=D([]),M=D([]),s=O({name:"",phone:"",storeId:""}),c=O({current:1,pageSize:20,total:0}),J=[{title:"用户ID",dataIndex:"id",key:"id",width:130},{title:"姓名",key:"name",width:100},{title:"岁数",key:"age",width:80},{title:"手机号",dataIndex:"phone",key:"phone",width:120},{title:"性别",key:"gender",width:80},{title:"婚况",key:"marriage",width:100},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",width:160},{title:"服务状态",key:"serviceStatus",width:120},{title:"操作",key:"actions",width:120,fixed:"right"}],q=async()=>{try{const t=await R.get("/stores");M.value=t.data||t||[]}catch(t){console.error("加载门店列表失败",t)}},k=async()=>{var t,e;I.value=!0;try{const r={page:c.current,limit:c.pageSize};s.name&&(r.name=s.name),s.phone&&(r.phone=s.phone),b.value&&s.storeId&&(r.storeId=s.storeId);const i=await R.get("/users/app",{params:r}),l=i.data||i;C.value=l.data||l||[],c.total=l.total||0}catch(r){oe.error(((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"加载用户列表失败")}finally{I.value=!1}},G=t=>{c.current=t.current,c.pageSize=t.pageSize,k()},S=()=>{c.current=1,k()},H=()=>{s.name="",s.phone="",s.storeId="",c.current=1,k()},K=t=>{Y.push(`/members/detail/${t.id}`)},Q=t=>{if(!t)return"-";const e=new Date(t),r=new Date;let i=r.getFullYear()-e.getFullYear();const l=r.getMonth()-e.getMonth();return(l<0||l===0&&r.getDate()<e.getDate())&&i--,i>0?`${i}岁`:"-"},z=t=>{var g;const e=(g=t.profile)==null?void 0:g.extInfo;if(!e)return"未开始";const r=e.serviceStartDate,i=e.serviceEndDate;if(!r)return"未开始";const l=new Date,w=new Date(r),m=i?new Date(i):null;return m&&l>m?"已结束":l>=w&&(!m||l<=m)?"服务中":"未开始"},W=t=>{const e=z(t);return e==="服务中"?"green":e==="已结束"?"default":"orange"};return ne(()=>{b.value&&q(),k()}),(t,e)=>{const r=u("a-page-header"),i=u("a-input"),l=u("a-form-item"),w=u("a-select-option"),m=u("a-select"),g=u("a-button"),F=u("a-space"),X=u("a-form"),Z=u("a-card"),A=u("a-tag"),ee=u("a-table");return d(),h("div",ce,[o(r,{title:"用户列表","sub-title":"查看和管理前台用户档案"}),o(Z,{style:{"margin-bottom":"16px"}},{default:a(()=>[o(X,{layout:"inline"},{default:a(()=>[o(l,{label:"姓名"},{default:a(()=>[o(i,{value:s.name,"onUpdate:value":e[0]||(e[0]=n=>s.name=n),placeholder:"请输入姓名",style:{width:"200px"},"allow-clear":"",onPressEnter:S},null,8,["value"])]),_:1}),o(l,{label:"手机号"},{default:a(()=>[o(i,{value:s.phone,"onUpdate:value":e[1]||(e[1]=n=>s.phone=n),placeholder:"请输入手机号",style:{width:"200px"},"allow-clear":"",onPressEnter:S},null,8,["value"])]),_:1}),b.value?(d(),v(l,{key:0,label:"门店"},{default:a(()=>[o(m,{value:s.storeId,"onUpdate:value":e[2]||(e[2]=n=>s.storeId=n),placeholder:"选择门店",style:{width:"200px"},"allow-clear":""},{default:a(()=>[o(w,{value:""},{default:a(()=>[...e[3]||(e[3]=[_("全部门店",-1)])]),_:1}),(d(!0),h(se,null,re(M.value,n=>(d(),v(w,{key:n.id,value:n.id},{default:a(()=>[_(y(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):f("",!0),o(l,null,{default:a(()=>[o(F,null,{default:a(()=>[o(g,{type:"primary",onClick:S},{icon:a(()=>[o(le(ie))]),default:a(()=>[e[4]||(e[4]=_(" 搜索 ",-1))]),_:1}),o(g,{onClick:H},{default:a(()=>[...e[5]||(e[5]=[_("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(ee,{columns:J,"data-source":C.value,loading:I.value,"row-key":"id",pagination:c,onChange:G,scroll:{x:1200}},{bodyCell:a(({column:n,record:p})=>{var E,N,B,L,P,T,U,V;return[n.key==="name"?(d(),h("span",pe,y(((N=(E=p.profile)==null?void 0:E.baseInfo)==null?void 0:N.name)||"-"),1)):f("",!0),n.key==="age"?(d(),h("span",fe,y(Q((L=(B=p.profile)==null?void 0:B.baseInfo)==null?void 0:L.birthday)),1)):f("",!0),n.key==="gender"?(d(),v(A,{key:2,color:((T=(P=p.profile)==null?void 0:P.baseInfo)==null?void 0:T.gender)==="男"?"blue":"pink"},{default:a(()=>{var x,$;return[_(y((($=(x=p.profile)==null?void 0:x.baseInfo)==null?void 0:$.gender)||"-"),1)]}),_:2},1032,["color"])):f("",!0),n.key==="marriage"?(d(),h("span",_e,y(((V=(U=p.profile)==null?void 0:U.baseInfo)==null?void 0:V.marriage)||"-"),1)):f("",!0),n.key==="serviceStatus"?(d(),v(A,{key:4,color:W(p)},{default:a(()=>[_(y(z(p)),1)]),_:2},1032,["color"])):f("",!0),n.key==="actions"?(d(),v(F,{key:5},{default:a(()=>[o(g,{type:"link",size:"small",onClick:x=>K(p)},{default:a(()=>[...e[6]||(e[6]=[_("查看档案",-1)])]),_:1},8,["onClick"])]),_:2},1024)):f("",!0)]}),_:1},8,["data-source","loading","pagination"])])}}}),he=de(me,[["__scopeId","data-v-b944a012"]]);export{he as default};
