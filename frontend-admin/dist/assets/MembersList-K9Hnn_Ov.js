import{d as oe,n as j,r as M,a as J,o as se,c as k,e as s,f as u,w as a,g as q,h as re,l as y,s as f,j as m,F as le,k as ie,v as ue,S as ce,t as g,u as de,i as c,_ as pe}from"./index-htUCjobA.js";const fe={class:"members-list"},me={key:0},_e={key:1},ye={key:3},ge=oe({__name:"MembersList",setup(ke){const G=de(),w=JSON.parse(localStorage.getItem("admin_user")||"{}"),I=j(()=>w.role==="super_admin"),U=j(()=>w.role==="matchmaker"),x=M(!1),z=M([]),F=M([]),n=J({name:"",phone:"",storeId:"",onlyMyUsers:!1}),d=J({current:1,pageSize:20,total:0}),H=[{title:"用户ID",dataIndex:"id",key:"id",width:130},{title:"姓名",key:"name",width:100},{title:"岁数",key:"age",width:80},{title:"手机号",dataIndex:"phone",key:"phone",width:120},{title:"性别",key:"gender",width:80},{title:"婚况",key:"marriage",width:100},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",width:160},{title:"服务状态",key:"serviceStatus",width:120},{title:"操作",key:"actions",width:120,fixed:"right"}],K=async()=>{try{const t=await q.get("/stores");F.value=t.data||t||[]}catch(t){console.error("加载门店列表失败",t)}},h=async()=>{var t,e;x.value=!0;try{const r={page:d.current,limit:d.pageSize};n.name&&(r.name=n.name),n.phone&&(r.phone=n.phone),I.value&&n.storeId&&(r.storeId=n.storeId),U.value&&n.onlyMyUsers&&(r.serviceMatchmakerId=w.id);const i=await q.get("/users/app",{params:r}),l=i.data||i;z.value=l.data||l||[],d.total=l.total||0}catch(r){re.error(((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"加载用户列表失败")}finally{x.value=!1}},Q=t=>{d.current=t.current,d.pageSize=t.pageSize,h()},v=()=>{d.current=1,h()},W=()=>{n.name="",n.phone="",n.storeId="",n.onlyMyUsers=!1,d.current=1,h()},X=t=>{G.push(`/members/detail/${t.id}`)},Z=t=>{if(!t)return"-";const e=new Date(t),r=new Date;let i=r.getFullYear()-e.getFullYear();const l=r.getMonth()-e.getMonth();return(l<0||l===0&&r.getDate()<e.getDate())&&i--,i>0?`${i}岁`:"-"},A=t=>{var b;const e=(b=t.profile)==null?void 0:b.extInfo;if(!e)return"未开始";const r=e.serviceStartDate,i=e.serviceEndDate;if(!r)return"未开始";const l=new Date,S=new Date(r),_=i?new Date(i):null;return _&&l>_?"已结束":l>=S&&(!_||l<=_)?"服务中":"未开始"},ee=t=>{const e=A(t);return e==="服务中"?"green":e==="已结束"?"default":"orange"};return se(()=>{I.value&&K(),h()}),(t,e)=>{const r=u("a-page-header"),i=u("a-input"),l=u("a-form-item"),S=u("a-checkbox"),_=u("a-select-option"),b=u("a-select"),D=u("a-button"),E=u("a-space"),te=u("a-form"),ae=u("a-card"),N=u("a-tag"),ne=u("a-table");return c(),k("div",fe,[s(r,{title:"用户列表","sub-title":"查看和管理前台用户档案"}),s(ae,{style:{"margin-bottom":"16px"}},{default:a(()=>[s(te,{layout:"inline"},{default:a(()=>[s(l,{label:"姓名"},{default:a(()=>[s(i,{value:n.name,"onUpdate:value":e[0]||(e[0]=o=>n.name=o),placeholder:"请输入姓名",style:{width:"200px"},"allow-clear":"",onPressEnter:v},null,8,["value"])]),_:1}),s(l,{label:"手机号"},{default:a(()=>[s(i,{value:n.phone,"onUpdate:value":e[1]||(e[1]=o=>n.phone=o),placeholder:"请输入手机号",style:{width:"200px"},"allow-clear":"",onPressEnter:v},null,8,["value"])]),_:1}),U.value?(c(),y(l,{key:0},{default:a(()=>[s(S,{checked:n.onlyMyUsers,"onUpdate:checked":e[2]||(e[2]=o=>n.onlyMyUsers=o),onChange:v},{default:a(()=>[...e[4]||(e[4]=[m(" 只看我负责的用户 ",-1)])]),_:1},8,["checked"])]),_:1})):f("",!0),I.value?(c(),y(l,{key:1,label:"门店"},{default:a(()=>[s(b,{value:n.storeId,"onUpdate:value":e[3]||(e[3]=o=>n.storeId=o),placeholder:"选择门店",style:{width:"200px"},"allow-clear":""},{default:a(()=>[s(_,{value:""},{default:a(()=>[...e[5]||(e[5]=[m("全部门店",-1)])]),_:1}),(c(!0),k(le,null,ie(F.value,o=>(c(),y(_,{key:o.id,value:o.id},{default:a(()=>[m(g(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):f("",!0),s(l,null,{default:a(()=>[s(E,null,{default:a(()=>[s(D,{type:"primary",onClick:v},{icon:a(()=>[s(ue(ce))]),default:a(()=>[e[6]||(e[6]=m(" 搜索 ",-1))]),_:1}),s(D,{onClick:W},{default:a(()=>[...e[7]||(e[7]=[m("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(ne,{columns:H,"data-source":z.value,loading:x.value,"row-key":"id",pagination:d,onChange:Q,scroll:{x:1200}},{bodyCell:a(({column:o,record:p})=>{var B,L,P,T,V,$,O,R;return[o.key==="name"?(c(),k("span",me,g(((L=(B=p.profile)==null?void 0:B.baseInfo)==null?void 0:L.name)||"-"),1)):f("",!0),o.key==="age"?(c(),k("span",_e,g(Z((T=(P=p.profile)==null?void 0:P.baseInfo)==null?void 0:T.birthday)),1)):f("",!0),o.key==="gender"?(c(),y(N,{key:2,color:(($=(V=p.profile)==null?void 0:V.baseInfo)==null?void 0:$.gender)==="男"?"blue":"pink"},{default:a(()=>{var C,Y;return[m(g(((Y=(C=p.profile)==null?void 0:C.baseInfo)==null?void 0:Y.gender)||"-"),1)]}),_:2},1032,["color"])):f("",!0),o.key==="marriage"?(c(),k("span",ye,g(((R=(O=p.profile)==null?void 0:O.baseInfo)==null?void 0:R.marriage)||"-"),1)):f("",!0),o.key==="serviceStatus"?(c(),y(N,{key:4,color:ee(p)},{default:a(()=>[m(g(A(p)),1)]),_:2},1032,["color"])):f("",!0),o.key==="actions"?(c(),y(E,{key:5},{default:a(()=>[s(D,{type:"link",size:"small",onClick:C=>X(p)},{default:a(()=>[...e[8]||(e[8]=[m("查看档案",-1)])]),_:1},8,["onClick"])]),_:2},1024)):f("",!0)]}),_:1},8,["data-source","loading","pagination"])])}}}),ve=pe(ge,[["__scopeId","data-v-bc0166bb"]]);export{ve as default};
