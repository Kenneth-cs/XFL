import{d as Q,r as m,n as O,o as W,c as A,e as s,f as d,w as a,g as S,h as p,j as r,l as f,s as v,t as w,F as X,k as Y,M as Z,i,_ as ee}from"./index-htUCjobA.js";const te={class:"staff-list"},ae={key:3,style:{color:"#999"}},le=Q({__name:"StaffList",setup(se){const I=m(!1),L=m([]),_=m(!1),y=m(null),b=m(""),C=m(),h=m(),c=O(()=>{const t=localStorage.getItem("admin_user");if(t)try{return JSON.parse(t)}catch{return null}return null}),x=O(()=>{var t;return((t=c.value)==null?void 0:t.role)==="super_admin"}),R=t=>!c.value||t.id===c.value.id?!1:x.value?!0:c.value.role==="admin"?!(t.storeId!==c.value.storeId||t.role==="super_admin"||t.role==="admin"):!1,U=()=>{var t;return x.value?[{value:"matchmaker",label:"普通红娘"},{value:"manager",label:"门店负责人"},{value:"admin",label:"门店老板"}]:((t=c.value)==null?void 0:t.role)==="admin"?[{value:"matchmaker",label:"普通红娘"},{value:"manager",label:"门店负责人"}]:[]},D=[{title:"用户ID",dataIndex:"id",key:"id",width:150},{title:"姓名",dataIndex:"name",key:"name",width:100},{title:"身份证号",dataIndex:"idCard",key:"idCard",width:180},{title:"注册门店",dataIndex:"storeId",key:"storeId",width:100},{title:"手机号",dataIndex:"phone",key:"phone",width:130},{title:"角色",key:"role",width:120},{title:"状态",key:"status",width:100},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"actions",width:280,fixed:"right"}],M=t=>({super_admin:"超级管理员",admin:"门店老板",manager:"门店负责人",matchmaker:"普通红娘"})[t]||t,V=t=>({super_admin:"red",admin:"purple",manager:"cyan",matchmaker:"blue"})[t]||"default",F=t=>({1:"正常",0:"待审核","-1":"禁用"})[t]||"未知",T=t=>({1:"green",0:"orange","-1":"red"})[t]||"default",k=async()=>{var t,e;I.value=!0;try{const o={};C.value&&(o.role=C.value),h.value!==void 0&&(o.status=h.value);const n=await S.get("/users/sys",{params:o});L.value=n.data||n||[]}catch(o){p.error(((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"加载人员列表失败")}finally{I.value=!1}},j=t=>{y.value=t,b.value=t.role,_.value=!0},J=async()=>{var t,e;if(y.value)try{await S.patch(`/users/sys/${y.value.id}/role`,{role:b.value}),p.success("角色修改成功"),_.value=!1,k()}catch(o){p.error(((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"操作失败")}},P=async t=>{var o,n;const e=t.status===1?-1:1;try{await S.patch(`/users/sys/${t.id}/status`,{status:e}),p.success(e===1?"启用成功":"禁用成功"),k()}catch(g){p.error(((n=(o=g.response)==null?void 0:o.data)==null?void 0:n.message)||"操作失败")}},q=t=>{Z.confirm({title:"重置密码",content:`确定要将 ${t.username} 的密码重置为默认密码 123456 吗？`,onOk:async()=>{var e,o;try{await S.patch(`/users/sys/${t.id}/reset-password`),p.success("密码已重置为 123456")}catch(n){p.error(((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||"操作失败")}}})};return W(()=>{k()}),(t,e)=>{const o=d("a-page-header"),n=d("a-select-option"),g=d("a-select"),z=d("a-space"),$=d("a-tag"),N=d("a-button"),G=d("a-table"),B=d("a-form-item"),H=d("a-form"),K=d("a-modal");return i(),A("div",te,[s(o,{title:"人员列表","sub-title":"查看和管理所有后台人员"}),s(z,{style:{"margin-bottom":"16px"}},{default:a(()=>[s(g,{value:C.value,"onUpdate:value":e[0]||(e[0]=l=>C.value=l),placeholder:"筛选角色",style:{width:"150px"},onChange:k,"allow-clear":""},{default:a(()=>[s(n,{value:"matchmaker"},{default:a(()=>[...e[5]||(e[5]=[r("普通红娘",-1)])]),_:1}),s(n,{value:"manager"},{default:a(()=>[...e[6]||(e[6]=[r("门店负责人",-1)])]),_:1}),s(n,{value:"admin"},{default:a(()=>[...e[7]||(e[7]=[r("门店老板",-1)])]),_:1}),s(n,{value:"super_admin"},{default:a(()=>[...e[8]||(e[8]=[r("超级管理员",-1)])]),_:1})]),_:1},8,["value"]),s(g,{value:h.value,"onUpdate:value":e[1]||(e[1]=l=>h.value=l),placeholder:"筛选状态",style:{width:"150px"},onChange:k,"allow-clear":""},{default:a(()=>[s(n,{value:1},{default:a(()=>[...e[9]||(e[9]=[r("正常",-1)])]),_:1}),s(n,{value:0},{default:a(()=>[...e[10]||(e[10]=[r("待审核",-1)])]),_:1}),s(n,{value:-1},{default:a(()=>[...e[11]||(e[11]=[r("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s(G,{columns:D,"data-source":L.value,loading:I.value,"row-key":"id"},{bodyCell:a(({column:l,record:u})=>[l.key==="role"?(i(),f($,{key:0,color:V(u.role)},{default:a(()=>[r(w(M(u.role)),1)]),_:2},1032,["color"])):v("",!0),l.key==="status"?(i(),f($,{key:1,color:T(u.status)},{default:a(()=>[r(w(F(u.status)),1)]),_:2},1032,["color"])):v("",!0),l.key==="actions"?(i(),f(z,{key:2},{default:a(()=>[R(u)?(i(),f(N,{key:0,type:"link",size:"small",onClick:E=>j(u)},{default:a(()=>[...e[12]||(e[12]=[r(" 修改角色 ",-1)])]),_:1},8,["onClick"])):v("",!0),R(u)?(i(),f(N,{key:1,type:"link",size:"small",danger:u.status===1,onClick:E=>P(u)},{default:a(()=>[r(w(u.status===1?"禁用":"启用"),1)]),_:2},1032,["danger","onClick"])):v("",!0),x.value?(i(),f(N,{key:2,type:"link",size:"small",onClick:E=>q(u)},{default:a(()=>[...e[13]||(e[13]=[r(" 重置密码 ",-1)])]),_:1},8,["onClick"])):v("",!0),!R(u)&&!x.value?(i(),A("span",ae," 无操作权限 ")):v("",!0)]),_:2},1024)):v("",!0)]),_:1},8,["data-source","loading"]),s(K,{open:_.value,"onUpdate:open":e[3]||(e[3]=l=>_.value=l),title:"修改角色",onOk:J,onCancel:e[4]||(e[4]=l=>_.value=!1)},{default:a(()=>[s(H,{"label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[s(B,{label:"当前角色"},{default:a(()=>{var l;return[s($,{color:V(((l=y.value)==null?void 0:l.role)||"")},{default:a(()=>{var u;return[r(w(M(((u=y.value)==null?void 0:u.role)||"")),1)]}),_:1},8,["color"])]}),_:1}),s(B,{label:"新角色"},{default:a(()=>[s(g,{value:b.value,"onUpdate:value":e[2]||(e[2]=l=>b.value=l),style:{width:"100%"}},{default:a(()=>[(i(!0),A(X,null,Y(U(),l=>(i(),f(n,{key:l.value,value:l.value},{default:a(()=>[r(w(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),oe=ee(le,[["__scopeId","data-v-b3b40144"]]);export{oe as default};
