import{d as W,r as v,a as Y,o as X,c as P,e as n,w as l,f as c,g as f,h as u,j as y,v as Z,P as ee,l as N,s as x,t as g,F as U,k as te,M as ae,E as ne,i as _,b as M,_ as oe}from"./index-htUCjobA.js";const le={class:"stores-list"},se={style:{"font-size":"12px",color:"#999"}},re=W({__name:"StoresList",setup(ce){const b=v(!1),T=v([]),D=v([]),p=v(!1),k=v(!1),C=v(),e=Y({id:"",name:"",mvTemplateId:void 0,businessLicenseName:"",creditCode:"",province:"",city:"",district:"",address:"",contactPerson:"",contactPhone:"",contractNumber:"",contractStartDate:"",contractEndDate:""}),w=Y({current:1,pageSize:10,total:0}),E=[{title:"门店ID",dataIndex:"id",key:"id",width:120},{title:"门店名称",dataIndex:"name",key:"name"},{title:"MV计算方案",key:"mvTemplateId",width:180},{title:"联系人",dataIndex:"contactPerson",key:"contactPerson",width:100},{title:"联系电话",dataIndex:"contactPhone",key:"contactPhone",width:130},{title:"状态",key:"status",width:80},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"actions",width:200,fixed:"right"}],L=s=>{const t=D.value.find(o=>o.id===s);return t?t.name:`未知方案(${s})`},V=async()=>{try{const s=await f.get("/stores/mv-templates/list");D.value=s}catch(s){console.error("获取MV方案列表失败:",s)}},h=async()=>{var s,t;b.value=!0;try{const o=await f.get("/stores");T.value=o}catch(o){u.error(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"加载门店列表失败")}finally{b.value=!1}},$=()=>{k.value=!1,Object.assign(e,{id:"",name:"",mvTemplateId:void 0,businessLicenseName:"",creditCode:"",province:"",city:"",district:"",address:"",contactPerson:"",contactPhone:"",contractNumber:"",contractStartDate:"",contractEndDate:""}),p.value=!0},z=s=>{k.value=!0,Object.assign(e,s),p.value=!0},O=async()=>{var s,t;try{await C.value.validate(),b.value=!0;const o={name:e.name,mvTemplateId:e.mvTemplateId};e.businessLicenseName&&(o.businessLicenseName=e.businessLicenseName),e.creditCode&&(o.creditCode=e.creditCode),e.province&&(o.province=e.province),e.city&&(o.city=e.city),e.district&&(o.district=e.district),e.address&&(o.address=e.address),e.contactPerson&&(o.contactPerson=e.contactPerson),e.contactPhone&&(o.contactPhone=e.contactPhone),e.contractNumber&&(o.contractNumber=e.contractNumber),e.contractStartDate&&(o.contractStartDate=e.contractStartDate),e.contractEndDate&&(o.contractEndDate=e.contractEndDate),k.value?(await f.patch(`/stores/${e.id}`,o),u.success("更新成功")):(await f.post("/stores",o),u.success("创建成功")),p.value=!1,h()}catch(o){console.error("提交失败:",o);const m=((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message||"操作失败";u.error(m)}finally{b.value=!1}},B=()=>{p.value=!1,C.value.resetFields()},j=async s=>{var t,o;try{await f.patch(`/stores/${s.id}/toggle-status`),u.success(s.status===1?"禁用成功":"启用成功"),h()}catch(m){u.error(((o=(t=m.response)==null?void 0:t.data)==null?void 0:o.message)||"操作失败")}},F=s=>{ae.confirm({title:"确认删除",icon:n(ne),content:`确定要删除门店"${s.name}"吗？删除后可能影响该门店下的所有用户数据。`,okText:"确认",okType:"danger",cancelText:"取消",async onOk(){var t,o;try{await f.delete(`/stores/${s.id}`),u.success("删除成功"),h()}catch(m){u.error(((o=(t=m.response)==null?void 0:t.data)==null?void 0:o.message)||"删除失败")}}})},q=s=>{w.current=s.current,w.pageSize=s.pageSize};return X(()=>{V(),h()}),(s,t)=>{const o=c("a-button"),m=c("a-page-header"),A=c("a-tag"),R=c("a-space"),H=c("a-table"),d=c("a-input"),r=c("a-form-item"),G=c("a-select-option"),J=c("a-select"),S=c("a-date-picker"),K=c("a-form"),Q=c("a-modal");return _(),P("div",le,[n(m,{title:"门店列表","sub-title":"管理所有门店信息"},{extra:l(()=>[n(o,{type:"primary",onClick:$},{icon:l(()=>[n(Z(ee))]),default:l(()=>[t[14]||(t[14]=y(" 新增门店 ",-1))]),_:1})]),_:1}),n(H,{columns:E,"data-source":T.value,loading:b.value,"row-key":"id",pagination:w,onChange:q},{bodyCell:l(({column:a,record:i})=>[a.key==="status"?(_(),N(A,{key:0,color:i.status===1?"green":"red"},{default:l(()=>[y(g(i.status===1?"正常":"禁用"),1)]),_:2},1032,["color"])):x("",!0),a.key==="mvTemplateId"?(_(),P(U,{key:1},[y(g(L(i.mvTemplateId)),1)],64)):x("",!0),a.key==="actions"?(_(),N(R,{key:2},{default:l(()=>[n(o,{type:"link",size:"small",onClick:I=>z(i)},{default:l(()=>[...t[15]||(t[15]=[y("编辑",-1)])]),_:1},8,["onClick"]),n(o,{type:"link",size:"small",danger:i.status===1,onClick:I=>j(i)},{default:l(()=>[y(g(i.status===1?"禁用":"启用"),1)]),_:2},1032,["danger","onClick"]),n(o,{type:"link",size:"small",danger:"",onClick:I=>F(i)},{default:l(()=>[...t[16]||(t[16]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)):x("",!0)]),_:1},8,["data-source","loading","pagination"]),n(Q,{open:p.value,"onUpdate:open":t[13]||(t[13]=a=>p.value=a),title:k.value?"编辑门店":"新增门店",onOk:O,onCancel:B,width:"800px","body-style":{maxHeight:"70vh",overflowY:"auto"}},{default:l(()=>[n(K,{ref_key:"formRef",ref:C,model:e,"label-col":{span:6},"wrapper-col":{span:16}},{default:l(()=>[n(r,{label:"门店名称",name:"name",rules:[{required:!0,message:"请输入门店名称"}]},{default:l(()=>[n(d,{value:e.name,"onUpdate:value":t[0]||(t[0]=a=>e.name=a),placeholder:"请输入门店名称"},null,8,["value"])]),_:1}),n(r,{label:"MV计算方案",name:"mvTemplateId",rules:[{required:!0,message:"请选择MV计算方案"}]},{default:l(()=>[n(J,{value:e.mvTemplateId,"onUpdate:value":t[1]||(t[1]=a=>e.mvTemplateId=a),placeholder:"请选择MV计算方案"},{default:l(()=>[(_(!0),P(U,null,te(D.value,a=>(_(),N(G,{key:a.id,value:a.id},{default:l(()=>[M("div",null,[M("div",null,g(a.name),1),M("div",se,g(a.description),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(r,{label:"营业执照名称",name:"businessLicenseName"},{default:l(()=>[n(d,{value:e.businessLicenseName,"onUpdate:value":t[2]||(t[2]=a=>e.businessLicenseName=a),placeholder:"请输入营业执照名称"},null,8,["value"])]),_:1}),n(r,{label:"统一社会信用代码",name:"creditCode"},{default:l(()=>[n(d,{value:e.creditCode,"onUpdate:value":t[3]||(t[3]=a=>e.creditCode=a),placeholder:"请输入统一社会信用代码（18位）",maxlength:"18"},null,8,["value"])]),_:1}),n(r,{label:"省份",name:"province"},{default:l(()=>[n(d,{value:e.province,"onUpdate:value":t[4]||(t[4]=a=>e.province=a),placeholder:"请输入省份"},null,8,["value"])]),_:1}),n(r,{label:"市",name:"city"},{default:l(()=>[n(d,{value:e.city,"onUpdate:value":t[5]||(t[5]=a=>e.city=a),placeholder:"请输入市"},null,8,["value"])]),_:1}),n(r,{label:"区",name:"district"},{default:l(()=>[n(d,{value:e.district,"onUpdate:value":t[6]||(t[6]=a=>e.district=a),placeholder:"请输入区"},null,8,["value"])]),_:1}),n(r,{label:"详细地址",name:"address"},{default:l(()=>[n(d,{value:e.address,"onUpdate:value":t[7]||(t[7]=a=>e.address=a),placeholder:"请输入详细地址"},null,8,["value"])]),_:1}),n(r,{label:"联系人",name:"contactPerson"},{default:l(()=>[n(d,{value:e.contactPerson,"onUpdate:value":t[8]||(t[8]=a=>e.contactPerson=a),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),n(r,{label:"联系方式",name:"contactPhone"},{default:l(()=>[n(d,{value:e.contactPhone,"onUpdate:value":t[9]||(t[9]=a=>e.contactPhone=a),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),n(r,{label:"合同号",name:"contractNumber"},{default:l(()=>[n(d,{value:e.contractNumber,"onUpdate:value":t[10]||(t[10]=a=>e.contractNumber=a),placeholder:"请输入合同号"},null,8,["value"])]),_:1}),n(r,{label:"签约时间",name:"contractStartDate"},{default:l(()=>[n(S,{value:e.contractStartDate,"onUpdate:value":t[11]||(t[11]=a=>e.contractStartDate=a),placeholder:"请选择签约时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),n(r,{label:"到期时间",name:"contractEndDate"},{default:l(()=>[n(S,{value:e.contractEndDate,"onUpdate:value":t[12]||(t[12]=a=>e.contractEndDate=a),placeholder:"请选择到期时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),ie=oe(re,[["__scopeId","data-v-fbcebbdc"]]);export{ie as default};
