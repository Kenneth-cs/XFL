import{e as a,I as fe,d as xe,r as M,a as ce,o as Ce,c as f,w as s,f as m,g as Q,h as P,j as w,b as i,s as N,l as z,F,k as H,A as Pe,t as o,u as De,i as d,v as X,C as Ue,x as Ne,_ as Ve}from"./index-C1RCBxAK.js";import{_ as ue}from"./HappinessRing.vue_vue_type_script_setup_true_lang-BLhs3XXv.js";import{b as je}from"./happiness-config-C0dL6Xsa.js";var ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M874 120H622c-3.3 0-6 2.7-6 6v56c0 3.3 2.7 6 6 6h160.4L583.1 387.3c-50-38.5-111-59.3-175.1-59.3-76.9 0-149.3 30-203.6 84.4S120 539.1 120 616s30 149.3 84.4 203.6C258.7 874 331.1 904 408 904s149.3-30 203.6-84.4C666 765.3 696 692.9 696 616c0-64.1-20.8-124.9-59.2-174.9L836 241.9V402c0 3.3 2.7 6 6 6h56c3.3 0 6-2.7 6-6V150c0-16.5-13.5-30-30-30zM408 828c-116.9 0-212-95.1-212-212s95.1-212 212-212 212 95.1 212 212-95.1 212-212 212z"}}]},name:"man",theme:"outlined"};function pe(p){for(var r=1;r<arguments.length;r++){var l=arguments[r]!=null?Object(arguments[r]):{},g=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(l).filter(function(b){return Object.getOwnPropertyDescriptor(l,b).enumerable}))),g.forEach(function(b){Ae(p,b,l[b])})}return p}function Ae(p,r,l){return r in p?Object.defineProperty(p,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):p[r]=l,p}var Z=function(r,l){var g=pe({},r,l.attrs);return a(fe,pe({},g,{icon:ze}),null)};Z.displayName="ManOutlined";Z.inheritAttrs=!1;var Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M712.8 548.8c53.6-53.6 83.2-125 83.2-200.8 0-75.9-29.5-147.2-83.2-200.8C659.2 93.6 587.8 64 512 64s-147.2 29.5-200.8 83.2C257.6 200.9 228 272.1 228 348c0 63.8 20.9 124.4 59.4 173.9 7.3 9.4 15.2 18.3 23.7 26.9 8.5 8.5 17.5 16.4 26.8 23.7 39.6 30.8 86.3 50.4 136.1 57V736H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h114v140c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V812h114c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H550V629.5c61.5-8.2 118.2-36.1 162.8-80.7zM512 556c-55.6 0-107.7-21.6-147.1-60.9C325.6 455.8 304 403.6 304 348s21.6-107.7 60.9-147.1C404.2 161.5 456.4 140 512 140s107.7 21.6 147.1 60.9C698.4 240.2 720 292.4 720 348s-21.6 107.7-60.9 147.1C619.7 534.4 567.6 556 512 556z"}}]},name:"woman",theme:"outlined"};function ve(p){for(var r=1;r<arguments.length;r++){var l=arguments[r]!=null?Object(arguments[r]):{},g=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(l).filter(function(b){return Object.getOwnPropertyDescriptor(l,b).enumerable}))),g.forEach(function(b){$e(p,b,l[b])})}return p}function $e(p,r,l){return r in p?Object.defineProperty(p,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):p[r]=l,p}var K=function(r,l){var g=ve({},r,l.attrs);return a(fe,ve({},g,{icon:Ee}),null)};K.displayName="WomanOutlined";K.inheritAttrs=!1;const Le={class:"members-match"},Te={class:"match-list"},Be={class:"batch-header"},Fe={class:"batch-time"},He={class:"batch-id"},Ye={class:"initiator-section"},We={class:"user-info"},Re={class:"user-name"},Ge={class:"user-gender"},qe={class:"user-id"},Je={class:"user-mv"},Qe={key:0,class:"candidate-info"},Xe={class:"name"},Ze={class:"id"},Ke={class:"mv-score"},et={key:1,class:"happiness-compare"},tt={class:"chart-item"},at={key:0},nt={key:1,class:"no-data-mini"},it={class:"chart-item"},st={key:0},ot={key:1,class:"no-data-mini"},lt={key:2,class:"match-result"},rt={class:"result-status"},dt={class:"match-score"},ct={class:"score-diff"},ut={key:3,class:"match-result"},pt={class:"result-status"},vt={class:"personality-details"},ft={key:0,class:"types-row"},mt={class:"types"},_t={key:1,class:"types-row"},ht={class:"types"},gt={class:"overlap-count"},yt={key:0,class:"pagination-container"},bt={key:0,class:"selected-user-info"},Mt={class:"range-input"},wt={class:"range-input"},kt={class:"range-input"},It=xe({__name:"MembersMatch",setup(p){const r=De(),l=M(!1),g=M([]),b=M(0),A=M(1),Y=M(10),y=ce({initiatorName:"",initiatorId:"",initiatorPhone:"",candidateName:"",candidateId:"",candidatePhone:""}),me=[{title:"å€™é€‰äºº",key:"candidate",width:120},{title:"å¹¸ç¦åŠ›å¯¹æ¯”",key:"happiness",width:280,align:"center"},{title:"MVåŒ¹é…",key:"mvMatch",width:180},{title:"æ€§æ ¼åŒ¹é…",key:"enneagramMatch",width:220},{title:"æ“ä½œ",key:"action",width:100,align:"right"}],E=M(!1),W=M(!1),$=M(!1),L=M([]),I=M(null),u=ce({initiatorId:void 0,criteria:{ageMin:void 0,ageMax:void 0,heightMin:void 0,heightMax:void 0,educationMin:void 0,educationMax:void 0}}),ee=["å¤§ä¸“ä»¥ä¸‹","å¤§ä¸“","äºŒæœ¬","æ™®é€šä¸€æœ¬","211å¤§å­¦","985æˆ–æ›´é«˜"],R=async()=>{l.value=!0;try{const n=await Q.get("/matches",{params:{...y,page:A.value,limit:Y.value}});console.log("ðŸ” [èŽ·å–åŒ¹é…åˆ—è¡¨] å“åº”æ•°æ®:",n),g.value=n.items||n||[],b.value=n.total||0}catch(n){console.error("âŒ [èŽ·å–åŒ¹é…åˆ—è¡¨å¤±è´¥]",n),P.error("èŽ·å–åŒ¹é…åˆ—è¡¨å¤±è´¥")}finally{l.value=!1}},G=()=>{A.value=1,R()},_e=()=>{Object.keys(y).forEach(n=>y[n]=""),G()},he=()=>{if(JSON.parse(localStorage.getItem("admin_user")||"{}").role==="super_admin"){P.warning("è¯·åˆ‡æ¢å¯¹åº”é—¨åº—è´¦å·è¿›è¡Œæ“ä½œ");return}E.value=!0,u.initiatorId=void 0,I.value=null,u.criteria={ageMin:void 0,ageMax:void 0,heightMin:void 0,heightMax:void 0,educationMin:void 0,educationMax:void 0}},ge=async n=>{if(n){$.value=!0,L.value=[];try{const e=await Q.get("/users/app",{params:{page:1,limit:50}});let _=[];Array.isArray(e.data)?_=e.data:Array.isArray(e)&&(_=e);const k=_.filter(c=>{var S,C;const h=String(((C=(S=c.profile)==null?void 0:S.baseInfo)==null?void 0:C.name)||""),x=String(c.phone||""),D=String(c.id||""),O=String(n).toLowerCase();return h.toLowerCase().includes(O)||x.includes(O)||D.toLowerCase().includes(O)});L.value=k.map(c=>{var h,x,D,O,S,C,T,V,U;return{id:c.id,name:((x=(h=c.profile)==null?void 0:h.baseInfo)==null?void 0:x.name)||"æœªå‘½å",phone:c.phone,gender:(O=(D=c.profile)==null?void 0:D.baseInfo)==null?void 0:O.gender,age:(C=(S=c.profile)==null?void 0:S.baseInfo)==null?void 0:C.age,education:(V=(T=c.profile)==null?void 0:T.baseInfo)==null?void 0:V.education,mvScore:(U=c.profile)==null?void 0:U.mvScore}})}catch(e){console.error(e),P.error("æœç´¢ç”¨æˆ·å¤±è´¥")}finally{$.value=!1}}},ye=n=>{I.value=L.value.find(e=>e.id===n)},be=async()=>{var e,_;if(!u.initiatorId){P.warning("è¯·é€‰æ‹©å‘èµ·äºº");return}const n={initiatorId:u.initiatorId,criteria:u.criteria};W.value=!0;try{const k=await Q.post("/matches/initiate",n);if(!k){P.error("æœåŠ¡å™¨å“åº”æ ¼å¼å¼‚å¸¸");return}const c=k.count||0;P.success(`åŒ¹é…å®Œæˆï¼Œå…±æ‰¾åˆ° ${c} ä½å€™é€‰äºº`),E.value=!1,R()}catch(k){P.error(((_=(e=k.response)==null?void 0:e.data)==null?void 0:_.message)||k.message||"å‘èµ·åŒ¹é…å¤±è´¥")}finally{W.value=!1}},Me=n=>Ne(n).format("YYYY-MM-DD HH:mm:ss"),te=n=>{var e,_;return((_=(e=n==null?void 0:n.profile)==null?void 0:e.baseInfo)==null?void 0:_.name)||(n==null?void 0:n.username)||"æœªçŸ¥ç”¨æˆ·"},we=n=>{var e,_;return(_=(e=n==null?void 0:n.profile)==null?void 0:e.baseInfo)==null?void 0:_.gender},ae=n=>{var e;return(e=n==null?void 0:n.profile)!=null&&e.mvScore?Number(n.profile.mvScore).toFixed(1):"-"},ke=n=>{const e=Math.abs(n);return Math.max(0,100-e*2)},ne=n=>!n||n.length===0?"æœªæµ‹è¯•":n.slice(0,3).map(e=>`${e}å·${je[e]}`).join(", "),Ie=n=>{r.push({name:"MatchDetail",params:{id:n.id}})};return Ce(()=>{R()}),(n,e)=>{const _=m("a-button"),k=m("a-page-header"),c=m("a-input"),h=m("a-form-item"),x=m("a-form"),D=m("a-card"),O=m("a-empty"),S=m("a-tag"),C=m("a-table"),T=m("a-pagination"),V=m("a-spin"),U=m("a-select-option"),q=m("a-select"),Oe=m("a-divider"),B=m("a-input-number"),J=m("a-col"),ie=m("a-row"),Se=m("a-modal");return d(),f("div",Le,[a(k,{title:"æ™ºèƒ½åŒ¹é…","sub-title":"åŸºäºŽMVå€¼ä¸Žä¹åž‹äººæ ¼çš„ç²¾å‡†åŒ¹é…"},{extra:s(()=>[a(_,{type:"primary",onClick:he},{default:s(()=>[...e[16]||(e[16]=[w("å‘èµ·åŒ¹é…",-1)])]),_:1})]),_:1}),a(D,{class:"mb-4"},{default:s(()=>[a(x,{layout:"inline"},{default:s(()=>[a(h,{label:"å‘èµ·æ–¹å§“å"},{default:s(()=>[a(c,{value:y.initiatorName,"onUpdate:value":e[0]||(e[0]=t=>y.initiatorName=t),placeholder:"è¾“å…¥å§“åæ¨¡ç³ŠæŸ¥è¯¢","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"å‘èµ·æ–¹ID"},{default:s(()=>[a(c,{value:y.initiatorId,"onUpdate:value":e[1]||(e[1]=t=>y.initiatorId=t),placeholder:"è¾“å…¥ç”¨æˆ·ID","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"å‘èµ·æ–¹æ‰‹æœºå·"},{default:s(()=>[a(c,{value:y.initiatorPhone,"onUpdate:value":e[2]||(e[2]=t=>y.initiatorPhone=t),placeholder:"è¾“å…¥æ‰‹æœºå·æ¨¡ç³ŠæŸ¥è¯¢","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"è¢«å‘èµ·æ–¹å§“å"},{default:s(()=>[a(c,{value:y.candidateName,"onUpdate:value":e[3]||(e[3]=t=>y.candidateName=t),placeholder:"è¾“å…¥å§“åæ¨¡ç³ŠæŸ¥è¯¢","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"è¢«å‘èµ·æ–¹ID"},{default:s(()=>[a(c,{value:y.candidateId,"onUpdate:value":e[4]||(e[4]=t=>y.candidateId=t),placeholder:"è¾“å…¥ç”¨æˆ·ID","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"è¢«å‘èµ·æ–¹æ‰‹æœºå·"},{default:s(()=>[a(c,{value:y.candidatePhone,"onUpdate:value":e[5]||(e[5]=t=>y.candidatePhone=t),placeholder:"è¾“å…¥æ‰‹æœºå·æ¨¡ç³ŠæŸ¥è¯¢","allow-clear":""},null,8,["value"])]),_:1}),a(h,null,{default:s(()=>[a(_,{type:"primary",onClick:G},{default:s(()=>[...e[17]||(e[17]=[w("æŸ¥è¯¢",-1)])]),_:1}),a(_,{style:{"margin-left":"8px"},onClick:_e},{default:s(()=>[...e[18]||(e[18]=[w("é‡ç½®",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(V,{spinning:l.value},{default:s(()=>[i("div",Te,[!l.value&&g.value.length===0?(d(),z(O,{key:0,description:"æš‚æ— åŒ¹é…è®°å½•"})):N("",!0),(d(!0),f(F,null,H(g.value,t=>(d(),f("div",{key:t.id,class:"match-batch-card"},[i("div",Be,[i("div",Fe,[a(X(Ue)),w(" åŒ¹é…æ—¶é—´ï¼š"+o(Me(t.createdAt)),1)]),i("div",He,"æ‰¹æ¬¡ID: "+o(t.id),1)]),i("div",Ye,[e[19]||(e[19]=i("div",{class:"section-label"},"å‘èµ·æ–¹ï¼š",-1)),i("div",We,[i("span",Re,o(te(t.initiator)),1),i("span",Ge,[we(t.initiator)==="ç”·"?(d(),z(X(Z),{key:0,style:{color:"#1890ff"}})):(d(),z(X(K),{key:1,style:{color:"#eb2f96"}}))]),i("span",qe,"(ID: "+o(t.initiatorId)+")",1),i("span",Je,"MV: "+o(ae(t.initiator)),1)])]),a(C,{dataSource:t.details,columns:me,pagination:!1,rowKey:"id",size:"middle",class:"candidates-table"},{bodyCell:s(({column:j,record:v})=>{var se,oe,le,re,de;return[j.key==="candidate"?(d(),f("div",Qe,[i("span",Xe,o(te(v.candidate)),1),i("span",Ze,"(ID: "+o(v.candidateId)+")",1),i("div",Ke,"MV: "+o(ae(v.candidate)),1)])):j.key==="happiness"?(d(),f("div",et,[i("div",tt,[e[20]||(e[20]=i("span",{class:"chart-label initiator-label"},"å‘èµ·æ–¹",-1)),(se=t.initiator)!=null&&se.happiness?(d(),f("div",at,[a(ue,{data:t.initiator.happiness,width:"90px",height:"90px"},null,8,["data"])])):(d(),f("div",nt,"æš‚æ— "))]),i("div",it,[e[21]||(e[21]=i("span",{class:"chart-label candidate-label"},"å€™é€‰æ–¹",-1)),(oe=v.candidate)!=null&&oe.happiness?(d(),f("div",st,[a(ue,{data:v.candidate.happiness,width:"90px",height:"90px"},null,8,["data"])])):(d(),f("div",ot,"æš‚æ— "))])])):j.key==="mvMatch"?(d(),f("div",lt,[i("div",rt,[e[22]||(e[22]=i("span",null,"å©šæ‹ä»·å€¼åŒ¹é…: ",-1)),a(S,{color:v.isMvPass?"success":"error"},{default:s(()=>[w(o(v.isMvPass?"é€šè¿‡":"ä¸é€šè¿‡"),1)]),_:2},1032,["color"])]),i("div",dt," åŒ¹é…å¾—åˆ†: "+o(ke(v.mvDiff)),1),i("div",ct,"åˆ†å·®: "+o(v.mvDiff>0?"+":"")+o(v.mvDiff),1)])):j.key==="enneagramMatch"?(d(),f("div",ut,[i("div",pt,[e[23]||(e[23]=i("span",null,"æ€§æ ¼åŒ¹é…: ",-1)),a(S,{color:v.isPersonalityPass?"success":"error"},{default:s(()=>[w(o(v.isPersonalityPass?"é€šè¿‡":"ä¸é€šè¿‡"),1)]),_:2},1032,["color"])]),i("div",vt,[(le=v.matchData)!=null&&le.initiatorTypes?(d(),f("div",ft,[e[24]||(e[24]=i("span",{class:"label"},"å‘èµ·æ–¹:",-1)),i("span",mt,o(ne(v.matchData.initiatorTypes)),1)])):N("",!0),(re=v.matchData)!=null&&re.candidateTypes?(d(),f("div",_t,[e[25]||(e[25]=i("span",{class:"label"},"å€™é€‰äºº:",-1)),i("span",ht,o(ne(v.matchData.candidateTypes)),1)])):N("",!0),i("div",gt,"é€‚åˆæ€§æ ¼é‡åˆ: "+o(((de=v.matchData)==null?void 0:de.overlapCount)||0)+"é¡¹",1)])])):j.key==="action"?(d(),z(_,{key:4,type:"link",size:"small",onClick:Ot=>Ie(v)},{default:s(()=>[...e[26]||(e[26]=[w("æŸ¥çœ‹è¯¦æƒ…",-1)])]),_:1},8,["onClick"])):N("",!0)]}),_:2},1032,["dataSource"])]))),128))]),b.value>0?(d(),f("div",yt,[a(T,{current:A.value,"onUpdate:current":e[6]||(e[6]=t=>A.value=t),pageSize:Y.value,"onUpdate:pageSize":e[7]||(e[7]=t=>Y.value=t),total:b.value,onChange:G,"show-size-changer":""},null,8,["current","pageSize","total"])])):N("",!0)]),_:1},8,["spinning"]),a(Se,{open:E.value,"onUpdate:open":e[15]||(e[15]=t=>E.value=t),title:"å‘èµ·æ™ºèƒ½åŒ¹é…",width:"600px",onOk:be,confirmLoading:W.value},{default:s(()=>[a(x,{layout:"vertical"},{default:s(()=>[a(h,{label:"é€‰æ‹©å‘èµ·äºº",required:""},{default:s(()=>[a(q,{value:u.initiatorId,"onUpdate:value":e[8]||(e[8]=t=>u.initiatorId=t),"show-search":"",placeholder:"è¾“å…¥å§“åæˆ–æ‰‹æœºå·æœç´¢","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":$.value?void 0:null,onSearch:ge,onChange:ye},Pe({default:s(()=>[(d(!0),f(F,null,H(L.value,t=>(d(),z(U,{key:t.id,value:t.id},{default:s(()=>[w(o(t.name)+"ï¼ˆ"+o(t.phone)+"ï¼‰ ",1)]),_:2},1032,["value"]))),128))]),_:2},[$.value?{name:"notFoundContent",fn:s(()=>[a(V,{size:"small"})]),key:"0"}:void 0]),1032,["value","not-found-content"]),I.value?(d(),f("div",bt,[i("p",null,"å·²é€‰: "+o(I.value.name)+" ("+o(I.value.gender)+", "+o(I.value.age)+"å², "+o(I.value.education)+")",1),i("p",null,"MVåˆ†: "+o(I.value.mvScore||"æœªè®¡ç®—"),1)])):N("",!0)]),_:1}),a(Oe),e[30]||(e[30]=i("p",{class:"section-title"},"å€™é€‰äººç­›é€‰æ¡ä»¶",-1)),a(ie,{gutter:16},{default:s(()=>[a(J,{span:12},{default:s(()=>[a(h,{label:"å¹´é¾„åŒºé—´"},{default:s(()=>[i("div",Mt,[a(B,{value:u.criteria.ageMin,"onUpdate:value":e[9]||(e[9]=t=>u.criteria.ageMin=t),placeholder:"æœ€å°",style:{width:"45%"}},null,8,["value"]),e[27]||(e[27]=i("span",{class:"separator"},"-",-1)),a(B,{value:u.criteria.ageMax,"onUpdate:value":e[10]||(e[10]=t=>u.criteria.ageMax=t),placeholder:"æœ€å¤§",style:{width:"45%"}},null,8,["value"])])]),_:1})]),_:1}),a(J,{span:12},{default:s(()=>[a(h,{label:"èº«é«˜åŒºé—´ (cm)"},{default:s(()=>[i("div",wt,[a(B,{value:u.criteria.heightMin,"onUpdate:value":e[11]||(e[11]=t=>u.criteria.heightMin=t),placeholder:"æœ€ä½Ž",style:{width:"45%"}},null,8,["value"]),e[28]||(e[28]=i("span",{class:"separator"},"-",-1)),a(B,{value:u.criteria.heightMax,"onUpdate:value":e[12]||(e[12]=t=>u.criteria.heightMax=t),placeholder:"æœ€é«˜",style:{width:"45%"}},null,8,["value"])])]),_:1})]),_:1})]),_:1}),a(ie,{gutter:16},{default:s(()=>[a(J,{span:24},{default:s(()=>[a(h,{label:"å­¦åŽ†è¦æ±‚"},{default:s(()=>[i("div",kt,[a(q,{value:u.criteria.educationMin,"onUpdate:value":e[13]||(e[13]=t=>u.criteria.educationMin=t),placeholder:"æœ€ä½Žå­¦åŽ†",style:{width:"45%"}},{default:s(()=>[(d(),f(F,null,H(ee,t=>a(U,{key:t,value:t},{default:s(()=>[w(o(t),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),e[29]||(e[29]=i("span",{class:"separator"},"è‡³",-1)),a(q,{value:u.criteria.educationMax,"onUpdate:value":e[14]||(e[14]=t=>u.criteria.educationMax=t),placeholder:"æœ€é«˜å­¦åŽ†",style:{width:"45%"}},{default:s(()=>[(d(),f(F,null,H(ee,t=>a(U,{key:t,value:t},{default:s(()=>[w(o(t),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open","confirmLoading"])])}}}),Pt=Ve(It,[["__scopeId","data-v-0f139ff3"]]);export{Pt as default};
